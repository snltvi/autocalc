<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä">
    <meta name="theme-color" content="#0057B7">
    <link rel="manifest" href="manifest.json?v=2.4">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Crect fill='%230057B7' width='200' height='200'/%3E%3Ctext x='100' y='120' font-size='100' text-anchor='middle' fill='white'%3Eüöõ%3C/text%3E%3C/svg%3E">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–æ–±—ñ–≤–∞—Ä—Ç–æ—Å—Ç—ñ —Ä–µ–π—Å—É v2.9</title>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0057B7;
            --secondary: #FFD700;
            --dark: #1a1a2e;
            --light: #f8f9fa;
            --border: #e0e6ed;
            --success: #00C853;
            --gradient: linear-gradient(135deg, #0057B7 0%, #004494 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Manrope', -apple-system, sans-serif;
            background: linear-gradient(to bottom, #f0f4f8 0%, #ffffff 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 15px;
        }

        .header {
            background: var(--gradient);
            color: white;
            padding: 25px 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 87, 183, 0.2);
            text-align: center;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 15px;
            border: 1px solid var(--border);
        }

        .card h2 {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--dark);
            font-size: 0.9rem;
        }

        input {
            width: 100%;
            padding: 12px 14px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            font-family: 'Manrope', sans-serif;
            transition: all 0.2s ease;
            background: white;
        }

        input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 87, 183, 0.1);
        }

        .input-group {
            position: relative;
        }

        .input-suffix {
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
            font-size: 0.85rem;
            font-weight: 600;
            pointer-events: none;
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: var(--gradient);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 87, 183, 0.3);
            -webkit-appearance: none;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .results {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
            border: 2px solid var(--secondary);
            display: none;
        }

        .results h2 {
            font-size: 1.3rem;
            font-weight: 800;
            margin-bottom: 20px;
            color: var(--dark);
        }

        .result-section {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .result-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .result-section h3 {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--primary);
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
        }

        .result-label {
            color: #495057;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .result-value {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 1rem;
            color: var(--dark);
        }

        .total-box {
            background: var(--gradient);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .total-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }

        .total-label {
            font-size: 1.1rem;
            font-weight: 700;
        }

        .total-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.5rem;
            font-weight: 800;
        }

        .cost-per-km {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.3);
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .hint {
            color: #6c757d;
            font-size: 0.8rem;
            margin-top: 5px;
            display: block;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .autocomplete {
            position: relative;
        }

        .autocomplete-items {
            position: absolute;
            border: 2px solid var(--border);
            border-top: none;
            border-radius: 0 0 8px 8px;
            z-index: 99;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 200px;
            overflow-y: auto;
            background: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            /* Prevent scroll jump */
            overflow-anchor: none;
        }

        .autocomplete-items div {
            padding: 12px;
            cursor: pointer;
            border-bottom: 1px solid var(--border);
            transition: background 0.2s ease;
        }

        .autocomplete-items div:hover {
            background: #e3f2fd;
        }

        .autocomplete-active {
            background: var(--primary) !important;
            color: white !important;
        }

        .city-match {
            font-weight: 700;
            color: var(--primary);
        }

        @media (max-width: 480px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .route-info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }

        .route-info-label {
            font-weight: 600;
            color: #1565c0;
            font-size: 0.9rem;
        }

        .route-info-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem;
            font-weight: 700;
            color: var(--primary);
        }

        /* Print styles */
        @media print {
            body * {
                visibility: hidden;
            }
            
            #waybillPrint, #waybillPrint * {
                visibility: visible;
            }
            
            #waybillPrint {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            
            .no-print {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöõ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–æ–±—ñ–≤–∞—Ä—Ç–æ—Å—Ç—ñ</h1>
            <p>–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤–∏—Ç—Ä–∞—Ç –Ω–∞ —Ä–µ–π—Å</p>
            <div style="margin-top: 8px; font-size: 0.75rem; opacity: 0.7;">v2.9 - –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –ø–∞–ª–∏–≤–∞</div>
        </div>

        <div class="card">
            <h2>üë§ –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –≤–æ–¥—ñ—è —Ç–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç</h2>

            <div class="form-group">
                <label for="driver">–í–æ–¥—ñ–π</label>
                <select id="driver" onchange="selectDriver()">
                    <option value="">-- –í–∏–±–µ—Ä—ñ—Ç—å –≤–æ–¥—ñ—è --</option>
                    <option value="0">–°—Ç–∞—Ä–æ–¥—É–± –°–µ—Ä–≥—ñ–π –û–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á</option>
                    <option value="1">–ù–∞—Ä–∏–≤–æ–Ω—á–∏–∫ –û–ª–µ–∫—Å–∞–Ω–¥—Ä –í–∞—Å–∏–ª—å–æ–≤–∏—á</option>
                    <option value="2">–î–∏–º–æ–≥–ª–æ–≤ –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤–∏—á</option>
                    <option value="3">–¢—É—Ä–∫—ñ–≤ –°—Ç–µ–ø–∞–Ω –î–º–∏—Ç—Ä–æ–≤–∏—á</option>
                    <option value="4">–î–µ–º—á–µ–Ω–∫–æ –û–ª–µ–∫—Å–µ–π –ë–æ—Ä–∏—Å–æ–≤–∏—á</option>
                    <option value="5">–ö—É–∑–Ω–µ—Ü–æ–≤ –°–µ—Ä–≥—ñ–π –í–æ–ª–æ–¥–∏–º–∏—Ä–æ–≤–∏—á</option>
                    <option value="6">–§–µ—Å–µ—á–∫–æ –û–ª–µ–∫—Å–∞–Ω–¥—Ä –ú–∏–∫–æ–ª–∞–π–æ–≤–∏—á</option>
                    <option value="7">–ö–æ–≤–∞–ª—å—á—É–∫ –û–ª–µ–≥ –ü–µ—Ç—Ä–æ–≤–∏—á</option>
                    <option value="8">–í–∞—Ä–µ–Ω—á—É–∫ –°–µ—Ä–≥—ñ–π –ê–Ω–∞—Ç–æ–ª—ñ–π–æ–≤–∏—á</option>
                    <option value="9">–§–∞—ó–Ω –ê–Ω–¥—Ä—ñ–π –ê–ª—å–±–µ—Ä—Ç–æ–≤–∏—á</option>
                    <option value="10">–Ñ–∂–¥—ñ–Ω –û–ª–µ–∫—Å–∞–Ω–¥—Ä</option>
                    <option value="11">–ö–∏—Ä–∏–ª–æ–≤ –†–æ—Å—Ç–∏—Å–ª–∞–≤ –ú–∏—Ö–∞–π–ª–æ–≤–∏—á</option>
                </select>
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label for="truck">–ù–æ–º–µ—Ä —Ç—è–≥–∞—á–∞</label>
                    <input type="text" id="truck" readonly style="background: #f8f9fa;">
                </div>

                <div class="form-group">
                    <label for="trailer">–ù–æ–º–µ—Ä –ø—Ä–∏—á–µ–ø–∞</label>
                    <input type="text" id="trailer" readonly style="background: #f8f9fa;">
                </div>
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label for="cardAmik">–ö–∞—Ä—Ç–∞ –ê–º—ñ–∫</label>
                    <input type="text" id="cardAmik" readonly style="background: #f8f9fa;">
                </div>

                <div class="form-group">
                    <label for="cardSocar">–ö–∞—Ä—Ç–∞ –°–æ–∫–∞—Ä</label>
                    <input type="text" id="cardSocar" readonly style="background: #f8f9fa;">
                </div>
            </div>
        </div>

        <div class="card">
            <h2>üìç –ú–∞—Ä—à—Ä—É—Ç</h2>
            
            <div style="padding: 12px; background: #e3f2fd; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid var(--primary);">
                <strong style="color: var(--primary);">üö© –ü—É–Ω–∫—Ç –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è</strong>
            </div>
            
            <div class="form-group">
                <label for="fromCity">–ú—ñ—Å—Ç–æ *</label>
                <div class="autocomplete">
                    <input type="text" id="fromCity" placeholder="–ö–∏—ó–≤" autocomplete="off">
                </div>
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label for="fromStreet">–í—É–ª–∏—Ü—è</label>
                    <div class="autocomplete">
                        <input type="text" id="fromStreet" placeholder="–≤—É–ª. –•—Ä–µ—â–∞—Ç–∏–∫" autocomplete="off">
                    </div>
                </div>

                <div class="form-group">
                    <label for="fromHouse">–ë—É–¥–∏–Ω–æ–∫</label>
                    <input type="text" id="fromHouse" placeholder="1" autocomplete="off">
                </div>
            </div>

            <div style="text-align: center; margin: 10px 0;">
                <button type="button" onclick="swapLocations()" style="background: white; border: 2px solid var(--primary); color: var(--primary); padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 1.2rem; transition: all 0.2s ease;">
                    üîÑ ‚áÖ
                </button>
            </div>

            <div style="padding: 12px; background: #fff3e0; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #f57c00;">
                <strong style="color: #f57c00;">üèÅ –ü—É–Ω–∫—Ç –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è</strong>
            </div>

            <div class="form-group">
                <label for="toCity">–ú—ñ—Å—Ç–æ *</label>
                <div class="autocomplete">
                    <input type="text" id="toCity" placeholder="–õ—å–≤—ñ–≤" autocomplete="off">
                </div>
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label for="toStreet">–í—É–ª–∏—Ü—è</label>
                    <div class="autocomplete">
                        <input type="text" id="toStreet" placeholder="–ø–ª. –†–∏–Ω–æ–∫" autocomplete="off">
                    </div>
                </div>

                <div class="form-group">
                    <label for="toHouse">–ë—É–¥–∏–Ω–æ–∫</label>
                    <input type="text" id="toHouse" placeholder="10" autocomplete="off">
                </div>
            </div>

            <button type="button" class="btn" onclick="calculateRoute()" style="margin-bottom: 15px; background: linear-gradient(135deg, #00C853 0%, #00A043 100%);">
                üîç –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –≤—ñ–¥—Å—Ç–∞–Ω—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
            </button>

            <div id="routeInfo" style="display: none; background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%); padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 2px solid #bbdefb;">
                <div id="loading" style="display: none; text-align: center; color: var(--primary); font-weight: 600;">
                    <div style="border: 3px solid rgba(0, 87, 183, 0.1); border-top: 3px solid var(--primary); border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; display: inline-block; margin-bottom: 10px;"></div>
                    <div>–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –º–∞—Ä—à—Ä—É—Ç—É...</div>
                </div>
                <div id="routeData"></div>
            </div>

            <div id="errorMsg" style="display: none; background: #ffebee; color: #c62828; padding: 12px; border-radius: 8px; margin-bottom: 15px; font-size: 0.85rem; border-left: 4px solid #c62828;"></div>

            <!-- Popular routes table -->
            <details id="routesDetails" style="margin-bottom: 15px;">
                <summary style="cursor: pointer; font-weight: 600; color: var(--primary); padding: 10px; background: #f0f4f8; border-radius: 8px; margin-bottom: 10px;">
                    üìã –ü–æ–ø—É–ª—è—Ä–Ω—ñ –º–∞—Ä—à—Ä—É—Ç–∏ (–Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –¥–ª—è –≤–∏–±–æ—Ä—É)
                </summary>
                <div style="background: white; border: 1px solid var(--border); border-radius: 8px; overflow: hidden; margin-top: 10px; max-height: 400px; overflow-y: auto;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
                        <thead style="position: sticky; top: 0; background: var(--gradient); z-index: 10;">
                            <tr style="color: white;">
                                <th style="padding: 10px; text-align: left;">–ú–∞—Ä—à—Ä—É—Ç</th>
                                <th style="padding: 10px; text-align: right;">–∫–º</th>
                                <th style="padding: 10px; text-align: center;">‚úì</th>
                            </tr>
                        </thead>
                        <tbody id="routesTable">
                            <!-- –ó –ö–∏—î–≤–∞ -->
                            <tr style="border-bottom: 1px solid var(--border); background: #f8f9fa;" onclick="selectRoute('–ö–∏—ó–≤', '–í—ñ–Ω–Ω–∏—Ü—è', 267)">
                                <td style="padding: 10px;"><strong>–ö–∏—ó–≤</strong> ‚Üí –í—ñ–Ω–Ω–∏—Ü—è</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">267</td>
                                <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border);" onclick="selectRoute('–ö–∏—ó–≤', '–î–Ω—ñ–ø—Ä–æ', 480)">
                                <td style="padding: 10px;"><strong>–ö–∏—ó–≤</strong> ‚Üí –î–Ω—ñ–ø—Ä–æ</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">480</td>
                                <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border); background: #f8f9fa;" onclick="selectRoute('–ö–∏—ó–≤', '–ñ–∏—Ç–æ–º–∏—Ä', 140)">
                                <td style="padding: 10px;"><strong>–ö–∏—ó–≤</strong> ‚Üí –ñ–∏—Ç–æ–º–∏—Ä</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">140</td>
                                <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border);" onclick="selectRoute('–ö–∏—ó–≤', '–ó–∞–ø–æ—Ä—ñ–∂–∂—è', 520)">
                                <td style="padding: 10px;"><strong>–ö–∏—ó–≤</strong> ‚Üí –ó–∞–ø–æ—Ä—ñ–∂–∂—è</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">520</td>
                                <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border); background: #f8f9fa;" onclick="selectRoute('–ö–∏—ó–≤', '–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫', 590)">
                                <td style="padding: 10px;"><strong>–ö–∏—ó–≤</strong> ‚Üí –Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">590</td>
                                <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border);" onclick="selectRoute('–ö–∏—ó–≤', '–ö—Ä–æ–ø–∏–≤–Ω–∏—Ü—å–∫–∏–π', 310)">
                                <td style="padding: 10px;"><strong>–ö–∏—ó–≤</strong> ‚Üí –ö—Ä–æ–ø–∏–≤–Ω–∏—Ü—å–∫–∏–π</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">310</td>
                                <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border); background: #f8f9fa;" onclick="selectRoute('–ö–∏—ó–≤', '–õ—É—Ü—å–∫', 410)">
                                <td style="padding: 10px;"><strong>–ö–∏—ó–≤</strong> ‚Üí –õ—É—Ü—å–∫</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">410</td>
                                <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border);" onclick="selectRoute('–ö–∏—ó–≤', '–õ—å–≤—ñ–≤', 540)">
                                <td style="padding: 10px;"><strong>–ö–∏—ó–≤</strong> ‚Üí –õ—å–≤—ñ–≤</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">540</td>
                                <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border); background: #f8f9fa;" onclick="selectRoute('–ö–∏—ó–≤', '–ú–∏–∫–æ–ª–∞—ó–≤', 490)">
                                <td style="padding: 10px;"><strong>–ö–∏—ó–≤</strong> ‚Üí –ú–∏–∫–æ–ª–∞—ó–≤</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">490</td>
                                <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border);" onclick="selectRoute('–ö–∏—ó–≤', '–û–¥–µ—Å–∞', 475)">
                                <td style="padding: 10px;"><strong>–ö–∏—ó–≤</strong> ‚Üí –û–¥–µ—Å–∞</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">475</td>
                                <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border); background: #f8f9fa;" onclick="selectRoute('–ö–∏—ó–≤', '–ü–æ–ª—Ç–∞–≤–∞', 340)">
                                <td style="padding: 10px;"><strong>–ö–∏—ó–≤</strong> ‚Üí –ü–æ–ª—Ç–∞–≤–∞</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">340</td>
                                <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border);" onclick="selectRoute('–ö–∏—ó–≤', '–†—ñ–≤–Ω–µ', 315)">
                                <td style="padding: 10px;"><strong>–ö–∏—ó–≤</strong> ‚Üí –†—ñ–≤–Ω–µ</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">315</td>
                                <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border); background: #f8f9fa;" onclick="selectRoute('–ö–∏—ó–≤', '–°—É–º–∏', 350)">
                                <td style="padding: 10px;"><strong>–ö–∏—ó–≤</strong> ‚Üí –°—É–º–∏</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">350</td>
                                <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border);" onclick="selectRoute('–ö–∏—ó–≤', '–¢–µ—Ä–Ω–æ–ø—ñ–ª—å', 440)">
                                <td style="padding: 10px;"><strong>–ö–∏—ó–≤</strong> ‚Üí –¢–µ—Ä–Ω–æ–ø—ñ–ª—å</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">440</td>
                                <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border); background: #f8f9fa;" onclick="selectRoute('–ö–∏—ó–≤', '–•–∞—Ä–∫—ñ–≤', 480)">
                                <td style="padding: 10px;"><strong>–ö–∏—ó–≤</strong> ‚Üí –•–∞—Ä–∫—ñ–≤</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">480</td>
                                <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border);" onclick="selectRoute('–ö–∏—ó–≤', '–•–µ—Ä—Å–æ–Ω', 600)">
                                <td style="padding: 10px;"><strong>–ö–∏—ó–≤</strong> ‚Üí –•–µ—Ä—Å–æ–Ω</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">600</td>
                                <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border); background: #f8f9fa;" onclick="selectRoute('–ö–∏—ó–≤', '–•–º–µ–ª—å–Ω–∏—Ü—å–∫–∏–π', 380)">
                                <td style="padding: 10px;"><strong>–ö–∏—ó–≤</strong> ‚Üí –•–º–µ–ª—å–Ω–∏—Ü—å–∫–∏–π</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">380</td>
                                <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border);" onclick="selectRoute('–ö–∏—ó–≤', '–ß–µ—Ä–∫–∞—Å–∏', 195)">
                                <td style="padding: 10px;"><strong>–ö–∏—ó–≤</strong> ‚Üí –ß–µ—Ä–∫–∞—Å–∏</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">195</td>
                                <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border); background: #f8f9fa;" onclick="selectRoute('–ö–∏—ó–≤', '–ß–µ—Ä–Ω—ñ–≤—Ü—ñ', 470)">
                                <td style="padding: 10px;"><strong>–ö–∏—ó–≤</strong> ‚Üí –ß–µ—Ä–Ω—ñ–≤—Ü—ñ</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">470</td>
                                <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border);" onclick="selectRoute('–ö–∏—ó–≤', '–ß–µ—Ä–Ω—ñ–≥—ñ–≤', 145)">
                                <td style="padding: 10px;"><strong>–ö–∏—ó–≤</strong> ‚Üí –ß–µ—Ä–Ω—ñ–≥—ñ–≤</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">145</td>
                                <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                            </tr>
                            
                            <!-- –Ü–Ω—à—ñ –ø–æ–ø—É–ª—è—Ä–Ω—ñ –º–∞—Ä—à—Ä—É—Ç–∏ -->
                            <tr style="border-bottom: 1px solid var(--border); background: #f8f9fa;" onclick="selectRoute('–õ—å–≤—ñ–≤', '–û–¥–µ—Å–∞', 790)">
                                <td style="padding: 10px;"><strong>–õ—å–≤—ñ–≤</strong> ‚Üí –û–¥–µ—Å–∞</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">790</td>
                                <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border);" onclick="selectRoute('–õ—å–≤—ñ–≤', '–•–∞—Ä–∫—ñ–≤', 1020)">
                                <td style="padding: 10px;"><strong>–õ—å–≤—ñ–≤</strong> ‚Üí –•–∞—Ä–∫—ñ–≤</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">1020</td>
                                <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border); background: #f8f9fa;" onclick="selectRoute('–õ—å–≤—ñ–≤', '–î–Ω—ñ–ø—Ä–æ', 820)">
                                <td style="padding: 10px;"><strong>–õ—å–≤—ñ–≤</strong> ‚Üí –î–Ω—ñ–ø—Ä–æ</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">820</td>
                                <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border);" onclick="selectRoute('–û–¥–µ—Å–∞', '–•–∞—Ä–∫—ñ–≤', 730)">
                                <td style="padding: 10px;"><strong>–û–¥–µ—Å–∞</strong> ‚Üí –•–∞—Ä–∫—ñ–≤</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">730</td>
                                <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border); background: #f8f9fa;" onclick="selectRoute('–û–¥–µ—Å–∞', '–î–Ω—ñ–ø—Ä–æ', 450)">
                                <td style="padding: 10px;"><strong>–û–¥–µ—Å–∞</strong> ‚Üí –î–Ω—ñ–ø—Ä–æ</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">450</td>
                                <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border);" onclick="selectRoute('–•–∞—Ä–∫—ñ–≤', '–î–Ω—ñ–ø—Ä–æ', 215)">
                                <td style="padding: 10px;"><strong>–•–∞—Ä–∫—ñ–≤</strong> ‚Üí –î–Ω—ñ–ø—Ä–æ</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">215</td>
                                <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border); background: #f8f9fa;" onclick="selectRoute('–•–∞—Ä–∫—ñ–≤', '–ó–∞–ø–æ—Ä—ñ–∂–∂—è', 280)">
                                <td style="padding: 10px;"><strong>–•–∞—Ä–∫—ñ–≤</strong> ‚Üí –ó–∞–ø–æ—Ä—ñ–∂–∂—è</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">280</td>
                                <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border);" onclick="selectRoute('–î–Ω—ñ–ø—Ä–æ', '–ó–∞–ø–æ—Ä—ñ–∂–∂—è', 85)">
                                <td style="padding: 10px;"><strong>–î–Ω—ñ–ø—Ä–æ</strong> ‚Üí –ó–∞–ø–æ—Ä—ñ–∂–∂—è</td>
                                <td style="padding: 10px; text-align: right; font-weight: 600;">85</td>
                                <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 8px; font-size: 0.8rem; color: #856404;">
                    üí° –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ –º–∞—Ä—à—Ä—É—Ç —â–æ–± –≤–∏–±—Ä–∞—Ç–∏ –π–æ–≥–æ. –í—Å—å–æ–≥–æ <strong id="routeCount">29 –º–∞—Ä—à—Ä—É—Ç—ñ–≤</strong> –∑ –æ–±–ª–∞—Å–Ω–∏–º–∏ —Ü–µ–Ω—Ç—Ä–∞–º–∏!
                </div>
                
                <div style="margin-top: 15px; padding: 15px; background: #e3f2fd; border-radius: 8px; border-left: 4px solid var(--primary);">
                    <div style="font-weight: 600; color: var(--primary); margin-bottom: 10px;">‚ûï –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π –º–∞—Ä—à—Ä—É—Ç</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 0.7fr auto; gap: 8px; align-items: end;">
                        <div>
                            <label style="font-size: 0.75rem; color: #666; display: block; margin-bottom: 3px;">–ó–≤—ñ–¥–∫–∏:</label>
                            <input type="text" id="newRouteFrom" placeholder="–ö–∏—ó–≤" style="width: 100%; padding: 6px; font-size: 0.85rem; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div>
                            <label style="font-size: 0.75rem; color: #666; display: block; margin-bottom: 3px;">–ö—É–¥–∏:</label>
                            <input type="text" id="newRouteTo" placeholder="–õ—å–≤—ñ–≤" style="width: 100%; padding: 6px; font-size: 0.85rem; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div>
                            <label style="font-size: 0.75rem; color: #666; display: block; margin-bottom: 3px;">–∫–º:</label>
                            <input type="number" id="newRouteDistance" placeholder="540" style="width: 100%; padding: 6px; font-size: 0.85rem; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <button onclick="addNewRoute()" style="padding: 6px 12px; background: var(--primary); color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85rem; font-weight: 600;">
                            ‚ûï –î–æ–¥–∞—Ç–∏
                        </button>
                    </div>
                    <div style="margin-top: 10px;">
                        <button onclick="saveRoutesToStorage()" style="padding: 6px 12px; background: #00C853; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem; font-weight: 600; margin-right: 5px;">
                            üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –º–∞—Ä—à—Ä—É—Ç–∏
                        </button>
                        <button onclick="loadRoutesFromStorage()" style="padding: 6px 12px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem; font-weight: 600; margin-right: 5px;">
                            üìÇ –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ
                        </button>
                        <button onclick="resetToDefaultRoutes()" style="padding: 6px 12px; background: #ff9800; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem; font-weight: 600;">
                            üîÑ –°–∫–∏–Ω—É—Ç–∏ –¥–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö
                        </button>
                    </div>
                </div>
            </details>

            <div class="form-group">
                <label for="distance">–í—ñ–¥—Å—Ç–∞–Ω—å –º–∞—Ä—à—Ä—É—Ç—É</label>
                <div class="input-group">
                    <input type="number" id="distance" value="500" min="0" inputmode="decimal">
                    <span class="input-suffix">–∫–º</span>
                </div>
                <small class="hint">üí° –í–∏–±–µ—Ä—ñ—Ç—å –∑ —Ç–∞–±–ª–∏—Ü—ñ, —Ä–æ–∑—Ä–∞—Ö—É–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∞–±–æ –≤–≤–µ–¥—ñ—Ç—å –≤—Ä—É—á–Ω—É</small>
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label for="tripStartDate">–î–∞—Ç–∞ —Ç–∞ —á–∞—Å –ø–æ—á–∞—Ç–∫—É —Ä–µ–π—Å—É</label>
                    <input type="datetime-local" id="tripStartDate">
                </div>

                <div class="form-group">
                    <label for="tripEndDate">–î–∞—Ç–∞ —Ç–∞ —á–∞—Å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ä–µ–π—Å—É</label>
                    <input type="datetime-local" id="tripEndDate">
                </div>
            </div>

            <div id="tripDuration" style="display: none; background: #e3f2fd; padding: 12px; border-radius: 8px; margin-top: 10px;">
                <div style="display: flex; justify-content: space-between;">
                    <span style="font-weight: 600; color: var(--primary);">‚è±Ô∏è –¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å —Ä–µ–π—Å—É:</span>
                    <span id="calculatedDuration" style="font-weight: 700; color: var(--primary);">0 –¥–Ω—ñ–≤</span>
                </div>
            </div>

            <div class="form-group">
                <label for="cargoName">–ù–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è –≤–∞–Ω—Ç–∞–∂—É</label>
                <input type="text" id="cargoName" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –ü—Ä–æ–¥—É–∫—Ü—ñ—è —Ö–∞—Ä—á–æ–≤–∞, –ë—É–¥–º–∞—Ç–µ—Ä—ñ–∞–ª–∏, —Ç–æ—â–æ" autocomplete="off">
                <small class="hint">üí° –ë—É–¥–µ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–æ –≤ –ø—É—Ç–∏–≤–Ω–æ–º—É –ª–∏—Å—Ç—ñ</small>
            </div>

            <div class="form-group">
                <label for="days">–ö—ñ–ª—å–∫—ñ—Å—Ç—å –¥–Ω—ñ–≤ —É –¥–æ—Ä–æ–∑—ñ</label>
                <div class="input-group">
                    <input type="number" id="days" value="2" min="1" inputmode="numeric">
                    <span class="input-suffix">–¥–Ω—ñ–≤</span>
                </div>
                <small class="hint">üí° –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–æ–∑—Ä–∞—Ö—É—î—Ç—å—Å—è –∑ –¥–∞—Ç –≤–∏—â–µ</small>
            </div>
        </div>

        <div class="card">
            <h2>üí∞ –í–∞—Ä—Ç—ñ—Å—Ç—å —Ä–µ–π—Å—É</h2>
            
            <div class="form-group">
                <label for="tripCost">–í–∞—Ä—Ç—ñ—Å—Ç—å —Ä–µ–π—Å—É (–æ–ø–ª–∞—Ç–∞ –∑–∞–º–æ–≤–Ω–∏–∫–∞)</label>
                <div class="input-group">
                    <input type="number" id="tripCost" value="0" step="100" inputmode="numeric">
                    <span class="input-suffix">–≥—Ä–Ω</span>
                </div>
                <small class="hint">üí° –°—É–º–∞, —è–∫—É –ø–ª–∞—Ç–∏—Ç—å –∑–∞–º–æ–≤–Ω–∏–∫ –∑–∞ –≤–µ—Å—å —Ä–µ–π—Å</small>
            </div>
        </div>

        <div class="card">
            <h2>üöó –ü–æ–∫–∞–∑–∞–Ω–Ω—è –ø—Ä–∏–ª–∞–¥—ñ–≤</h2>
            
            <div class="grid-2">
                <div class="form-group">
                    <label for="odometerStart">–û–¥–æ–º–µ—Ç—Ä –Ω–∞ –ø–æ—á–∞—Ç–æ–∫</label>
                    <div class="input-group">
                        <input type="number" id="odometerStart" value="0" step="1" inputmode="numeric">
                        <span class="input-suffix">–∫–º</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="odometerEnd">–û–¥–æ–º–µ—Ç—Ä –≤ –∫—ñ–Ω—Ü—ñ</label>
                    <div class="input-group">
                        <input type="number" id="odometerEnd" value="0" step="1" inputmode="numeric">
                        <span class="input-suffix">–∫–º</span>
                    </div>
                </div>
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label for="fuelStart">–ü–∞–ª–∏–≤–æ –Ω–∞ –ø–æ—á–∞—Ç–æ–∫</label>
                    <div class="input-group">
                        <input type="number" id="fuelStart" value="0" step="1" inputmode="numeric">
                        <span class="input-suffix">–ª</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="fuelEnd">–ü–∞–ª–∏–≤–æ –≤ –∫—ñ–Ω—Ü—ñ</label>
                    <div class="input-group">
                        <input type="number" id="fuelEnd" value="0" step="1" inputmode="numeric">
                        <span class="input-suffix">–ª</span>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="fuelRefill">–ó–∞–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –¥–æ—Ä–æ–∑—ñ</label>
                <div class="input-group">
                    <input type="number" id="fuelRefill" value="0" step="1" inputmode="numeric">
                    <span class="input-suffix">–ª</span>
                </div>
                <small class="hint">üí° –°–∫—ñ–ª—å–∫–∏ –ª—ñ—Ç—Ä—ñ–≤ –∑–∞–ø—Ä–∞–≤–∏–ª–∏ –ø—ñ–¥ —á–∞—Å —Ä–µ–π—Å—É</small>
            </div>

            <div id="fuelCalculation" style="display: none; background: #e3f2fd; padding: 15px; border-radius: 10px; margin-top: 10px;">
                <div style="font-weight: 600; color: var(--primary); margin-bottom: 8px;">üìä –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫:</div>
                <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                    <span>–ü—Ä–æ–±—ñ–≥ –∑–∞ —Ä–µ–π—Å (—Ä—ñ–∑–Ω–∏—Ü—è):</span>
                    <span id="calculatedDistance" style="font-weight: 700;">0 –∫–º</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                    <span>–í–∏—Ç—Ä–∞—á–µ–Ω–æ –ø–∞–ª–∏–≤–∞:</span>
                    <span id="calculatedFuelUsed" style="font-weight: 700;">0 –ª</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                    <span>–§–∞–∫—Ç–∏—á–Ω–∞ –≤–∏—Ç—Ä–∞—Ç–∞:</span>
                    <span id="calculatedConsumption" style="font-weight: 700; color: var(--primary);">0 –ª/100–∫–º</span>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>‚õΩ –ü–∞–ª–∏–≤–æ</h2>
            
            <div class="grid-2">
                <div class="form-group">
                    <label for="fuelConsumption">–í–∏—Ç—Ä–∞—Ç–∞ –ø–∞–ª–∏–≤–∞</label>
                    <div class="input-group">
                        <input type="number" id="fuelConsumption" value="25" step="0.1" inputmode="decimal">
                        <span class="input-suffix">–ª/100–∫–º</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="fuelPrice">–¶—ñ–Ω–∞ –ø–∞–ª–∏–≤–∞</label>
                    <div class="input-group">
                        <input type="number" id="fuelPrice" value="55" step="0.1" inputmode="decimal">
                        <span class="input-suffix">–≥—Ä–Ω/–ª</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>üë§ –í–æ–¥—ñ–π</h2>

            <div class="form-group">
                <label for="salary">–ó–∞—Ä–ø–ª–∞—Ç–∞ –≤–æ–¥—ñ—è –∑–∞ —Ä–µ–π—Å</label>
                <div class="input-group">
                    <input type="number" id="salary" value="0" step="100" inputmode="numeric" readonly style="background: #f8f9fa;">
                    <span class="input-suffix">–≥—Ä–Ω</span>
                </div>
                <small class="hint">üî¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ: 15% –≤—ñ–¥ –≤–∞—Ä—Ç–æ—Å—Ç—ñ —Ä–µ–π—Å—É</small>
            </div>

            <div class="form-group">
                <label for="perDiem">–î–æ–±–æ–≤—ñ</label>
                <div class="input-group">
                    <input type="number" id="perDiem" value="600" step="10" inputmode="numeric">
                    <span class="input-suffix">–≥—Ä–Ω/–¥–µ–Ω—å</span>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>üí∞ –Ü–Ω—à—ñ –≤–∏—Ç—Ä–∞—Ç–∏</h2>
            
            <div class="form-group">
                <label for="amortization">–ê–º–æ—Ä—Ç–∏–∑–∞—Ü—ñ—è</label>
                <div class="input-group">
                    <input type="number" id="amortization" value="0" step="100" inputmode="numeric">
                    <span class="input-suffix">–≥—Ä–Ω</span>
                </div>
            </div>

            <div class="form-group">
                <label for="maintenance">–†–µ–º–æ–Ω—Ç —Ç–∞ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è</label>
                <div class="input-group">
                    <input type="number" id="maintenance" value="0" step="100" inputmode="numeric">
                    <span class="input-suffix">–≥—Ä–Ω</span>
                </div>
            </div>

            <div class="form-group">
                <label for="other">–Ü–Ω—à—ñ –≤–∏—Ç—Ä–∞—Ç–∏ (–¥–æ—Ä–æ–∂–Ω—ñ –∑–±–æ—Ä–∏)</label>
                <div class="input-group">
                    <input type="number" id="other" value="0" step="100" inputmode="numeric">
                    <span class="input-suffix">–≥—Ä–Ω</span>
                </div>
            </div>

            <button class="btn" onclick="calculate()">–†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ —Å–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å</button>
            
            <button class="btn" onclick="printWaybill()" style="margin-top: 10px; background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);">
                üñ®Ô∏è –ü—É—Ç–∏–≤–Ω–∏–π –ª–∏—Å—Ç (–¥—Ä—É–∫/PDF)
            </button>
            
            <button class="btn" onclick="saveWaybillAsHTML()" style="margin-top: 10px; background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%);">
                üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–≤—ñ—Ç (HTML)
            </button>
        </div>

        <div class="results" id="results">
            <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏</h2>

            <div class="result-section">
                <h3>–í–∏—Ç—Ä–∞—Ç–∏ –Ω–∞ –ø–∞–ª–∏–≤–æ</h3>
                <div class="result-item">
                    <span class="result-label">–ó–∞–≥–∞–ª—å–Ω–∞ –≤–∏—Ç—Ä–∞—Ç–∞:</span>
                    <span class="result-value" id="totalFuel">0 –ª</span>
                </div>
                <div class="result-item">
                    <span class="result-label">–í–∞—Ä—Ç—ñ—Å—Ç—å –ø–∞–ª–∏–≤–∞:</span>
                    <span class="result-value" id="fuelCost">0 –≥—Ä–Ω</span>
                </div>
            </div>

            <div class="result-section">
                <h3>–í–∏—Ç—Ä–∞—Ç–∏ –Ω–∞ –æ–ø–ª–∞—Ç—É –ø—Ä–∞—Ü—ñ</h3>
                <div class="result-item">
                    <span class="result-label">–ó–∞—Ä–ø–ª–∞—Ç–∞:</span>
                    <span class="result-value" id="salaryResult">0 –≥—Ä–Ω</span>
                </div>
                <div class="result-item">
                    <span class="result-label">–î–æ–±–æ–≤—ñ:</span>
                    <span class="result-value" id="perDiemResult">0 –≥—Ä–Ω</span>
                </div>
            </div>

            <div class="result-section">
                <h3>–Ü–Ω—à—ñ –≤–∏—Ç—Ä–∞—Ç–∏</h3>
                <div class="result-item">
                    <span class="result-label">–ê–º–æ—Ä—Ç–∏–∑–∞—Ü—ñ—è:</span>
                    <span class="result-value" id="amortizationResult">0 –≥—Ä–Ω</span>
                </div>
                <div class="result-item">
                    <span class="result-label">–†–µ–º–æ–Ω—Ç:</span>
                    <span class="result-value" id="maintenanceResult">0 –≥—Ä–Ω</span>
                </div>
                <div class="result-item">
                    <span class="result-label">–Ü–Ω—à—ñ:</span>
                    <span class="result-value" id="otherResult">0 –≥—Ä–Ω</span>
                </div>
            </div>

            <div class="total-box">
                <div class="total-item">
                    <span class="total-label">–°–û–ë–Ü–í–ê–†–¢–Ü–°–¢–¨:</span>
                    <span class="total-value" id="totalCost">0 –≥—Ä–Ω</span>
                </div>
                <div class="cost-per-km">
                    <div class="total-item" style="padding: 0;">
                        <span>–í–∞—Ä—Ç—ñ—Å—Ç—å 1 –∫–º:</span>
                        <span id="costPerKm" style="font-size: 1.2rem;">0 –≥—Ä–Ω/–∫–º</span>
                    </div>
                </div>
            </div>

            <div id="profitBox" style="background: linear-gradient(135deg, #00C853 0%, #00A043 100%); color: white; padding: 20px; border-radius: 10px; margin-top: 15px; display: none;">
                <div class="total-item">
                    <span class="total-label">–î–û–•–Ü–î –ó–ê–ú–û–í–ù–ò–ö–ê:</span>
                    <span class="total-value" id="tripCostDisplay">0 –≥—Ä–Ω</span>
                </div>
                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255, 255, 255, 0.3);">
                    <div class="total-item" style="padding: 0;">
                        <span style="font-size: 1.1rem; font-weight: 700;">–ß–ò–°–¢–ò–ô –ü–†–ò–ë–£–¢–û–ö:</span>
                        <span id="profit" style="font-size: 1.5rem; font-weight: 800;">0 –≥—Ä–Ω</span>
                    </div>
                    <div class="total-item" style="padding-top: 8px;">
                        <span style="font-size: 0.9rem;">–†–µ–Ω—Ç–∞–±–µ–ª—å–Ω—ñ—Å—Ç—å:</span>
                        <span id="profitMargin" style="font-size: 1.1rem; font-weight: 700;">0%</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö –≤–æ–¥—ñ—ó–≤ –∑ –≤–∞—à–æ–≥–æ Excel —Ñ–∞–π–ª—É
        const driversData = [
            {name: "–°—Ç–∞—Ä–æ–¥—É–± –°–µ—Ä–≥—ñ–π –û–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á", truck: "BH5291PX", trailer: "–í–ù4453XF", cardAmik: "6328", cardSocar: "9052"},
            {name: "–ù–∞—Ä–∏–≤–æ–Ω—á–∏–∫ –û–ª–µ–∫—Å–∞–Ω–¥—Ä –í–∞—Å–∏–ª—å–æ–≤–∏—á", truck: "–í–ù5651–†–í", trailer: "–í–ù2898XH", cardAmik: "6323", cardSocar: "9110"},
            {name: "–î–∏–º–æ–≥–ª–æ–≤ –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤–∏—á", truck: "BH4721PH", trailer: "–í–ù0459XF", cardAmik: "6322", cardSocar: "9078"},
            {name: "–¢—É—Ä–∫—ñ–≤ –°—Ç–µ–ø–∞–Ω –î–º–∏—Ç—Ä–æ–≤–∏—á", truck: "–í–ù7532–†–°", trailer: "–í–ù4741–•–ù", cardAmik: "6329", cardSocar: "9094"},
            {name: "–î–µ–º—á–µ–Ω–∫–æ –û–ª–µ–∫—Å–µ–π –ë–æ—Ä–∏—Å–æ–≤–∏—á", truck: "–í–ù5290–†–•", trailer: "–í–ù5232XF", cardAmik: "6325", cardSocar: "9045"},
            {name: "–ö—É–∑–Ω–µ—Ü–æ–≤ –°–µ—Ä–≥—ñ–π –í–æ–ª–æ–¥–∏–º–∏—Ä–æ–≤–∏—á", truck: "BH4492PT", trailer: "BH6578XF", cardAmik: "6327", cardSocar: "9086"},
            {name: "–§–µ—Å–µ—á–∫–æ –û–ª–µ–∫—Å–∞–Ω–¥—Ä –ú–∏–∫–æ–ª–∞–π–æ–≤–∏—á", truck: "BH6394PB", trailer: "–í–ù4837XF", cardAmik: "6321", cardSocar: "9037"},
            {name: "–ö–æ–≤–∞–ª—å—á—É–∫ –û–ª–µ–≥ –ü–µ—Ç—Ä–æ–≤–∏—á", truck: "–í–ù8941–†–°", trailer: "–í–ù4697XF", cardAmik: "6339", cardSocar: "-"},
            {name: "–í–∞—Ä–µ–Ω—á—É–∫ –°–µ—Ä–≥—ñ–π –ê–Ω–∞—Ç–æ–ª—ñ–π–æ–≤–∏—á", truck: "–í–ù1575–†–ö", trailer: "–í–ù1354–•–ù", cardAmik: "6324", cardSocar: "9029"},
            {name: "–§–∞—ó–Ω –ê–Ω–¥—Ä—ñ–π –ê–ª—å–±–µ—Ä—Ç–æ–≤–∏—á", truck: "–í–ù5685–†–ú", trailer: "–í–ù5158XF", cardAmik: "6326", cardSocar: "9060"},
            {name: "–Ñ–∂–¥—ñ–Ω –û–ª–µ–∫—Å–∞–Ω–¥—Ä", truck: "–í–ù4723–†–ù", trailer: "–í–ù4847XF", cardAmik: "6334", cardSocar: "9102"},
            {name: "–ö–∏—Ä–∏–ª–æ–≤ –†–æ—Å—Ç–∏—Å–ª–∞–≤ –ú–∏—Ö–∞–π–ª–æ–≤–∏—á", truck: "–í–ù6395–†–í", trailer: "–í–ù4379XF", cardAmik: "6303", cardSocar: "-"}
        ];

        function selectDriver() {
            const driverSelect = document.getElementById('driver');
            const selectedIndex = driverSelect.value;

            if (selectedIndex === "") {
                // –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –ø–æ–ª—è
                document.getElementById('truck').value = "";
                document.getElementById('trailer').value = "";
                document.getElementById('cardAmik').value = "";
                document.getElementById('cardSocar').value = "";
                return;
            }

            const driver = driversData[parseInt(selectedIndex)];
            
            // –ó–∞–ø–æ–≤–Ω–∏—Ç–∏ –ø–æ–ª—è
            document.getElementById('truck').value = driver.truck;
            document.getElementById('trailer').value = driver.trailer;
            document.getElementById('cardAmik').value = driver.cardAmik;
            document.getElementById('cardSocar').value = driver.cardSocar;

            // –î–æ–¥–∞—Ç–∏ –∞–Ω—ñ–º–∞—Ü—ñ—é
            ['truck', 'trailer', 'cardAmik', 'cardSocar'].forEach(id => {
                const field = document.getElementById(id);
                field.style.transform = 'scale(1.05)';
                field.style.background = '#e3f2fd';
                setTimeout(() => {
                    field.style.transform = 'scale(1)';
                    field.style.background = '#f8f9fa';
                }, 300);
            });
        }

        // –°–ø–∏—Å–æ–∫ –º—ñ—Å—Ç –£–∫—Ä–∞—ó–Ω–∏, –ú–æ–ª–¥–æ–≤–∏, –†—É–º—É–Ω—ñ—ó, –ë–æ–ª–≥–∞—Ä—ñ—ó —Ç–∞ –¢—É—Ä–µ—á—á–∏–Ω–∏
        const ukrainianCities = [
            // –£–∫—Ä–∞—ó–Ω–∞ - –æ–±–ª–∞—Å–Ω—ñ —Ü–µ–Ω—Ç—Ä–∏
            "–ö–∏—ó–≤", "–•–∞—Ä–∫—ñ–≤", "–û–¥–µ—Å–∞", "–î–Ω—ñ–ø—Ä–æ", "–î–æ–Ω–µ—Ü—å–∫", "–ó–∞–ø–æ—Ä—ñ–∂–∂—è", "–õ—å–≤—ñ–≤",
            "–í—ñ–Ω–Ω–∏—Ü—è", "–ü–æ–ª—Ç–∞–≤–∞", "–ß–µ—Ä–Ω—ñ–≥—ñ–≤", "–ß–µ—Ä–∫–∞—Å–∏", "–•–º–µ–ª—å–Ω–∏—Ü—å–∫–∏–π", "–ñ–∏—Ç–æ–º–∏—Ä",
            "–°—É–º–∏", "–†—ñ–≤–Ω–µ", "–ö—Ä–æ–ø–∏–≤–Ω–∏—Ü—å–∫–∏–π", "–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫", "–¢–µ—Ä–Ω–æ–ø—ñ–ª—å", "–õ—É—Ü—å–∫",
            "–ú–∏–∫–æ–ª–∞—ó–≤", "–•–µ—Ä—Å–æ–Ω", "–ß–µ—Ä–Ω—ñ–≤—Ü—ñ", "–£–∂–≥–æ—Ä–æ–¥",
            
            // –£–∫—Ä–∞—ó–Ω–∞ - –≤–µ–ª–∏–∫—ñ –º—ñ—Å—Ç–∞
            "–ö—Ä–∏–≤–∏–π –†—ñ–≥", "–ú–∞—Ä—ñ—É–ø–æ–ª—å", "–õ—É–≥–∞–Ω—Å—å–∫", "–ú–∞–∫—ñ—ó–≤–∫–∞", "–°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å", "–°—ñ–º—Ñ–µ—Ä–æ–ø–æ–ª—å",
            "–ì–æ—Ä–ª—ñ–≤–∫–∞", "–ö–∞–º'—è–Ω—Å—å–∫–µ", "–ö—Ä–µ–º–µ–Ω—á—É–∫", "–ë—ñ–ª–∞ –¶–µ—Ä–∫–≤–∞", "–ö—Ä–∞–º–∞—Ç–æ—Ä—Å—å–∫", "–ú–µ–ª—ñ—Ç–æ–ø–æ–ª—å",
            "–ö–µ—Ä—á", "–ù—ñ–∫–æ–ø–æ–ª—å", "–°–ª–æ–≤'—è–Ω—Å—å–∫", "–ë–µ—Ä–¥—è–Ω—Å—å–∫", "–ê–ª—á–µ–≤—Å—å–∫", "–ü–∞–≤–ª–æ–≥—Ä–∞–¥",
            "–Ñ–≤–ø–∞—Ç–æ—Ä—ñ—è", "–°—î–≤—î—Ä–æ–¥–æ–Ω–µ—Ü—å–∫", "–õ–∏—Å–∏—á–∞–Ω—Å—å–∫", "–ö–∞–º'—è–Ω–µ—Ü—å-–ü–æ–¥—ñ–ª—å—Å—å–∫–∏–π", "–ë—Ä–æ–≤–∞—Ä–∏",
            "–î—Ä–æ–≥–æ–±–∏—á", "–ö—Ä–∞—Å–Ω–∏–π –õ—É—á", "–Ø–ª—Ç–∞", "–ú—É–∫–∞—á–µ–≤–æ", "–ö–æ–Ω–æ—Ç–æ–ø", "–£–º–∞–Ω—å",
            "–ö–æ—Å—Ç—è–Ω—Ç–∏–Ω—ñ–≤–∫–∞", "–ë—ñ–ª–≥–æ—Ä–æ–¥-–î–Ω—ñ—Å—Ç—Ä–æ–≤—Å—å–∫–∏–π", "–ï–Ω–µ—Ä–≥–æ–¥–∞—Ä", "–ö—Ä–∞—Å–Ω–æ–¥–æ–Ω", "–§–µ–æ–¥–æ—Å—ñ—è",
            
            // –ú–æ–ª–¥–æ–≤–∞
            "–ö–∏—à–∏–Ω—ñ–≤", "–¢–∏—Ä–∞—Å–ø–æ–ª—å", "–ë–µ–ª—å—Ü—ñ", "–ë–µ–Ω–¥–µ—Ä–∏", "–†–∏–±–Ω–∏—Ü—è", "–ö–∞–≥—É–ª", "–£–Ω–≥–µ–Ω–∏",
            "–°–æ—Ä–æ–∫–∏", "–û—Ä—Ö–µ–π", "–î—É–±–æ—Å—Å–∞—Ä–∏", "–ö–æ–º—Ä–∞—Ç", "–ß–∞–¥–∏—Ä-–õ—É–Ω–≥–∞", "–ï–¥–∏–Ω—Ü—ñ", "–ö–∏—à–∏–Ω–∞—É",
            "–ö–∏—à–∏–Ω–µ–≤", "Chisinau", "Balti", "Tiraspol",
            
            // –†—É–º—É–Ω—ñ—è - –≤–µ–ª–∏–∫—ñ –º—ñ—Å—Ç–∞
            "–ë—É—Ö–∞—Ä–µ—Å—Ç", "–ö–ª—É–∂-–ù–∞–ø–æ–∫–∞", "–¢—ñ–º—ñ—à–æ–∞—Ä–∞", "–Ø—Å–∏", "–ö–æ–Ω—Å—Ç–∞–Ω—Ü–∞", "–ö—Ä–∞–π–æ–≤–∞", "–ë—Ä–∞—à–æ–≤",
            "–ì–∞–ª–∞—Ü", "–ü–ª–æ—î—à—Ç—ñ", "–ë—Ä–µ—Ü–ª–∞", "–û—Ä–∞–¥—è", "–ë–∞–∫–µ—É", "–ê—Ä–∞–¥", "–ü—ñ—Ç–µ—à—Ç—ñ", "–°—ñ–±—ñ—É",
            "–¢–∏—Ä–≥—É-–ú—É—Ä–µ—à", "–ë–∞—è-–ú–∞—Ä–µ", "–ë—É–∑–µ—É", "–ë–æ—Ç–æ—à–∞–Ω—ñ", "–°–∞—Ç—É-–ú–∞—Ä–µ", "–†–∏–º–Ω—ñ–∫—É-–í–∏–ª—á–∞",
            "–°—É—á–∞–≤–∞", "–§–æ–∫—à–∞–Ω–∏", "–¢—É–ª—á–∞", "–î–∂—É—Ä–¥–∂—É", "–†–µ—Å—ñ—Ü–∞", "–î–µ–≤–∞", "–°–ª–∞—Ç–∏–Ω–∞",
            "–¢—É—Ä–Ω—É-–°–µ–≤–µ—Ä–∏–Ω", "–ë–∏—Å—Ç—Ä–∏—Ü—è", "–ö–∞–ª–∞—Ä–∞—à—ñ", "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ—è", "–ú–µ–¥—ñ–∞—à", "–í–∞—Å–ª—É–π",
            "–†–æ–º–∞–Ω", "–¢—É—Ä–¥–∞", "–ë—É—Ö–∞—Äe—Å—Ç", "Bucure»ôti", "Cluj-Napoca", "Timi»ôoara", "Ia»ôi",
            "Constan»õa", "Craiova", "Bra»ôov", "Gala»õi", "Ploie»ôti",
            
            // –ë–æ–ª–≥–∞—Ä—ñ—è - –≤–µ–ª–∏–∫—ñ –º—ñ—Å—Ç–∞
            "–°–æ—Ñ—ñ—è", "–ü–ª–æ–≤–¥—ñ–≤", "–í–∞—Ä–Ω–∞", "–ë—É—Ä–≥–∞—Å", "–†—É—Å–µ", "–°—Ç–∞—Ä–∞ –ó–∞–≥–æ—Ä–∞", "–ü–ª–µ–≤–µ–Ω",
            "–°–ª–∏–≤–µ–Ω", "–î–æ–±—Ä–∏—á", "–®—É–º–µ–Ω", "–ü–µ—Ä–Ω–∏–∫", "–•–∞—Å–∫–æ–≤–æ", "–Ø–º–±–æ–ª", "–ü–∞–∑–∞—Ä–¥–∂–∏–∫",
            "–ë–ª–∞–≥–æ—î–≤–≥—Ä–∞–¥", "–í–µ–ª–∏–∫–æ-–¢–∏—Ä–Ω–æ–≤–æ", "–í—Ä–∞—Ü–∞", "–ì–∞–±—Ä–æ–≤–æ", "–ê—Å–µ–Ω–æ–≤–≥—Ä–∞–¥", "–í–∏–¥—ñ–Ω",
            "–ö–∞–∑–∞–Ω–ª–∏–∫", "–ö–∏—Ä–¥–∂–∞–ª—ñ", "–ö–∞—Ä–ª–æ–≤–æ", "–ü–µ—Ç—Ä–∏—á", "–í–µ–ª—ñ–Ω–≥—Ä–∞–¥", "–ú–æ–Ω—Ç–∞–Ω–∞", "–õ–æ–≤–µ—á",
            "–°–∏–ª—ñ—Å—Ç—Ä–∞", "–†–∞–∑–≥—Ä–∞–¥", "–î–∏–º–∏—Ç—Ä–æ–≤–≥—Ä–∞–¥", "–°–æ—Ñ—ñ—è", "–°–æ—Ñ–∏—è", "Sofia", "Plovdiv",
            "Varna", "Burgas",
            
            // –¢—É—Ä–µ—á—á–∏–Ω–∞ - –≤–µ–ª–∏–∫—ñ –º—ñ—Å—Ç–∞
            "–°—Ç–∞–º–±—É–ª", "–ê–Ω–∫–∞—Ä–∞", "–Ü–∑–º—ñ—Ä", "–ë—É—Ä—Å–∞", "–ê–¥–∞–Ω–∞", "–ì–∞–∑—ñ–∞–Ω—Ç–µ–ø", "–ö–æ–Ω—å—è", "–ê–Ω—Ç–∞–ª—å—è",
            "–ö–∞–π—Å–µ—Ä—ñ", "–ú–µ—Ä—Å—ñ–Ω", "–ï—Å–∫—ñ—à–µ—Ö—ñ—Ä", "–î—ñ—è—Ä–±–∞–∫–∏—Ä", "–°–∞–º—Å—É–Ω", "–î–µ–Ω—ñ–∑–ª—ñ", "–®–∞–Ω–ª–∏—É—Ä—Ñ–∞",
            "–ê–¥–∞–ø—Ç–∞–∑–∞—Ä–∏", "–ú–∞–ª–∞—Ç—å—è", "–ö–∞—Ö—Ä–∞–º–∞–Ω–º–∞—Ä–∞—à", "–ï—Ä–∑—É—Ä—É–º", "–í–∞–Ω", "–ë–∞—Ç–º–∞–Ω", "–ï–ª—è–∑–∏–≥",
            "–ï—Ä–∑–∏–Ω–¥–∂–∞–Ω", "–¢—Ä–∞–±–∑–æ–Ω", "–ú–∞–Ω—ñ—Å—Å–∞", "–ö–∞–π—Å–µ—Ä—ñ", "–°—ñ–≤–∞—Å", "–ì–µ–±–∑–µ", "–ë–∞–ª—ñ–∫–µ—Å—ñ—Ä",
            "–£—à–∞–∫", "–°–∞–∫–∞—Ä—å—è", "–û—Ä–¥—É", "–ï—Ä–∑—ñ–Ω–¥–∂–∞–Ω", "–ê–ª–∞–Ω–∏—è", "–ú–∞—Ä–º–∞—Ä–∏—Å", "–ë–æ–¥—Ä—É–º", "–ö—É—à–∞–¥–∞—Å–∏",
            "–§–µ—Ç—Ö—ñ—î", "–°—ñ–¥–µ", "–ë–µ–ª–µ–∫", "–ö–∞–ø–ø–∞–¥–æ–∫—ñ—è", "–ü–∞–º—É–∫–∫–∞–ª–µ", "–°—Ç–∞–º–±—É–ª", "ƒ∞stanbul",
            "Ankara", "ƒ∞zmir", "Bursa", "Antalya", "Konya"
        ];

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∞–≤—Ç–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –¥–ª—è –ø–æ–ª—ñ–≤ –º—ñ—Å—Ç
        initAutocomplete(document.getElementById("fromCity"));
        initAutocomplete(document.getElementById("toCity"));
        
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∞–≤—Ç–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –¥–ª—è –ø–æ–ª—ñ–≤ –≤—É–ª–∏—Ü—å
        initStreetAutocomplete(document.getElementById("fromStreet"), document.getElementById("fromCity"));
        initStreetAutocomplete(document.getElementById("toStreet"), document.getElementById("toCity"));

        function initAutocomplete(input) {
            let currentFocus;
            let searchTimeout;

            input.addEventListener("input", async function(e) {
                const val = this.value;
                closeAllLists();
                
                // Don't show autocomplete if looks like a full address being typed
                // (contains comma or looks complete)
                if (!val || val.length < 2) { 
                    return false; 
                }
                
                // If user is typing a full address (has comma), don't interrupt
                if (val.includes(',') && val.length > 10) {
                    return false;
                }
                
                currentFocus = -1;

                const autocompleteDiv = document.createElement("DIV");
                autocompleteDiv.setAttribute("id", this.id + "-autocomplete-list");
                autocompleteDiv.setAttribute("class", "autocomplete-items");
                this.parentNode.appendChild(autocompleteDiv);

                // Show loading
                const loadingDiv = document.createElement("DIV");
                loadingDiv.innerHTML = "üîç –ü–æ—à—É–∫...";
                loadingDiv.style.pointerEvents = "none";
                loadingDiv.style.color = "#6c757d";
                autocompleteDiv.appendChild(loadingDiv);

                // Clear previous timeout
                if (searchTimeout) clearTimeout(searchTimeout);

                // Search with delay to avoid too many requests
                searchTimeout = setTimeout(async () => {
                    try {
                        // Search in predefined list first for quick results
                        let matches = [];
                        for (let i = 0; i < ukrainianCities.length; i++) {
                            if (ukrainianCities[i].toLowerCase().includes(val.toLowerCase())) {
                                matches.push(ukrainianCities[i]);
                                if (matches.length >= 5) break;
                            }
                        }

                        let apiResults = [];
                        try {
                            // Search only in Ukraine, Moldova, Romania, Bulgaria, Turkey
                            const response = await fetch(
                                `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(val)}&countrycodes=ua,md,ro,bg,tr&limit=5&addressdetails=1`,
                                {
                                    headers: {
                                        'Accept-Language': 'uk,ru,en,ro,bg,tr'
                                    }
                                }
                            );
                            if (response.ok) {
                                apiResults = await response.json();
                            }
                        } catch (apiError) {
                            console.warn('API –ø–æ—à—É–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Ç—ñ–ª—å–∫–∏ –ª–æ–∫–∞–ª—å–Ω–∏–π —Å–ø–∏—Å–æ–∫:', apiError);
                        }

                        // Clear loading
                        autocompleteDiv.innerHTML = '';

                        // Combine results (remove duplicates)
                        const allResults = new Set();
                        
                        // Add predefined matches first
                        matches.forEach(city => allResults.add(city));
                        
                        // Add API results
                        apiResults.forEach(result => {
                            if (result.display_name) {
                                // For full addresses, keep the full text
                                // For cities, extract just city name
                                let displayText;
                                
                                if (result.address) {
                                    // If it's a city or town, use just the city name
                                    if (result.type === 'city' || result.type === 'town' || result.type === 'administrative') {
                                        displayText = result.address.city || result.address.town || result.address.village || result.display_name.split(',')[0];
                                    } else {
                                        // For streets/addresses, show full address
                                        displayText = result.display_name.split(',').slice(0, 3).join(',').trim();
                                    }
                                } else {
                                    // Fallback - first part
                                    displayText = result.display_name.split(',')[0].trim();
                                }
                                
                                allResults.add(displayText);
                            }
                        });

                        const resultsArray = Array.from(allResults).slice(0, 8);

                        if (resultsArray.length > 0) {
                            resultsArray.forEach(cityName => {
                                const itemDiv = document.createElement("DIV");
                                
                                // Highlight matching part
                                const lowerCity = cityName.toLowerCase();
                                const lowerVal = val.toLowerCase();
                                const matchIndex = lowerCity.indexOf(lowerVal);
                                
                                if (matchIndex >= 0) {
                                    const beforeMatch = cityName.substr(0, matchIndex);
                                    const match = cityName.substr(matchIndex, val.length);
                                    const afterMatch = cityName.substr(matchIndex + val.length);
                                    itemDiv.innerHTML = beforeMatch + "<span class='city-match'>" + match + "</span>" + afterMatch;
                                } else {
                                    itemDiv.innerHTML = cityName;
                                }
                                
                                itemDiv.innerHTML += "<input type='hidden' value='" + cityName + "'>";
                                
                                itemDiv.addEventListener("click", function(e) {
                                    input.value = this.getElementsByTagName("input")[0].value;
                                    closeAllLists();
                                });
                                
                                autocompleteDiv.appendChild(itemDiv);
                            });
                        } else {
                            const noMatch = document.createElement("DIV");
                            noMatch.innerHTML = "<span style='color: #6c757d;'>üí° –ü—Ä–æ–¥–æ–≤–∂—É–π—Ç–µ –≤–≤–æ–¥–∏—Ç–∏ –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—é –º–∞—Ä—à—Ä—É—Ç—ñ–≤</span>";
                            noMatch.style.pointerEvents = "none";
                            autocompleteDiv.appendChild(noMatch);
                        }
                    } catch (error) {
                        console.error('Autocomplete error:', error);
                        autocompleteDiv.innerHTML = '';
                        const errorDiv = document.createElement("DIV");
                        errorDiv.innerHTML = "<span style='color: #6c757d;'>‚úèÔ∏è –ü—Ä–æ—Å—Ç–æ –≤–≤–æ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –º—ñ—Å—Ç–∞</span>";
                        errorDiv.style.pointerEvents = "none";
                        autocompleteDiv.appendChild(errorDiv);
                    }
                }, 500); // 500ms delay

            });

            input.addEventListener("keydown", function(e) {
                let x = document.getElementById(this.id + "-autocomplete-list");
                if (x) x = x.getElementsByTagName("div");
                if (e.keyCode == 40) { // DOWN
                    currentFocus++;
                    addActive(x);
                } else if (e.keyCode == 38) { // UP
                    currentFocus--;
                    addActive(x);
                } else if (e.keyCode == 13) { // ENTER
                    e.preventDefault();
                    if (currentFocus > -1) {
                        if (x) x[currentFocus].click();
                    }
                }
            });

            function addActive(x) {
                if (!x) return false;
                removeActive(x);
                if (currentFocus >= x.length) currentFocus = 0;
                if (currentFocus < 0) currentFocus = (x.length - 1);
                x[currentFocus].classList.add("autocomplete-active");
            }

            function removeActive(x) {
                for (let i = 0; i < x.length; i++) {
                    x[i].classList.remove("autocomplete-active");
                }
            }

            function closeAllLists(elmnt) {
                const items = document.getElementsByClassName("autocomplete-items");
                for (let i = 0; i < items.length; i++) {
                    if (elmnt != items[i] && elmnt != input) {
                        items[i].parentNode.removeChild(items[i]);
                    }
                }
            }

            document.addEventListener("click", function (e) {
                closeAllLists(e.target);
            });
        }

        function initStreetAutocomplete(streetInput, cityInput) {
            let currentFocus;
            let searchTimeout;

            streetInput.addEventListener("input", async function(e) {
                const streetVal = this.value;
                const cityVal = cityInput.value.trim();
                
                closeAllListsStreet();
                
                // Need at least 2 characters and a city selected
                if (!streetVal || streetVal.length < 2) { 
                    return false; 
                }
                
                if (!cityVal) {
                    return false; // No city selected
                }
                
                currentFocus = -1;

                const autocompleteDiv = document.createElement("DIV");
                autocompleteDiv.setAttribute("id", this.id + "-autocomplete-list");
                autocompleteDiv.setAttribute("class", "autocomplete-items");
                this.parentNode.appendChild(autocompleteDiv);

                // Show loading
                const loadingDiv = document.createElement("DIV");
                loadingDiv.innerHTML = "üîç –ü–æ—à—É–∫ –≤—É–ª–∏—Ü—å...";
                loadingDiv.style.pointerEvents = "none";
                loadingDiv.style.color = "#6c757d";
                autocompleteDiv.appendChild(loadingDiv);

                // Clear previous timeout
                if (searchTimeout) clearTimeout(searchTimeout);

                // Search with delay
                searchTimeout = setTimeout(async () => {
                    try {
                        // Search for streets in the selected city (only in specified countries)
                        const searchQuery = `${streetVal}, ${cityVal}`;
                        
                        console.log('–ü–æ—à—É–∫ –≤—É–ª–∏—Ü—å:', searchQuery);
                        
                        const response = await fetch(
                            `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(searchQuery)}&countrycodes=ua,md,ro,bg,tr&limit=8&addressdetails=1`,
                            {
                                headers: {
                                    'Accept-Language': 'uk,ru,en,ro,bg,tr'
                                }
                            }
                        );
                        
                        if (!response.ok) {
                            throw new Error('API error');
                        }
                        
                        const results = await response.json();
                        console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ—à—É–∫—É –≤—É–ª–∏—Ü—å:', results);

                        // Clear loading
                        autocompleteDiv.innerHTML = '';

                        // Filter to only streets/roads
                        const streets = results.filter(r => 
                            r.address && (r.address.road || r.address.pedestrian || r.address.footway)
                        );

                        // Extract unique street names
                        const uniqueStreets = new Set();
                        streets.forEach(result => {
                            if (result.address) {
                                const streetName = result.address.road || result.address.pedestrian || result.address.footway;
                                if (streetName) {
                                    uniqueStreets.add(streetName);
                                }
                            }
                        });

                        const streetsArray = Array.from(uniqueStreets).slice(0, 8);
                        console.log('–£–Ω—ñ–∫–∞–ª—å–Ω—ñ –≤—É–ª–∏—Ü—ñ:', streetsArray);

                        if (streetsArray.length > 0) {
                            streetsArray.forEach(streetName => {
                                const itemDiv = document.createElement("DIV");
                                
                                // Highlight matching part
                                const lowerStreet = streetName.toLowerCase();
                                const lowerVal = streetVal.toLowerCase();
                                const matchIndex = lowerStreet.indexOf(lowerVal);
                                
                                if (matchIndex >= 0) {
                                    const beforeMatch = streetName.substr(0, matchIndex);
                                    const match = streetName.substr(matchIndex, streetVal.length);
                                    const afterMatch = streetName.substr(matchIndex + streetVal.length);
                                    itemDiv.innerHTML = beforeMatch + "<span class='city-match'>" + match + "</span>" + afterMatch;
                                } else {
                                    itemDiv.innerHTML = streetName;
                                }
                                
                                itemDiv.innerHTML += "<input type='hidden' value='" + streetName + "'>";
                                
                                itemDiv.addEventListener("click", function(e) {
                                    streetInput.value = this.getElementsByTagName("input")[0].value;
                                    closeAllListsStreet();
                                });
                                
                                autocompleteDiv.appendChild(itemDiv);
                            });
                        } else {
                            const noMatch = document.createElement("DIV");
                            noMatch.innerHTML = "<span style='color: #6c757d;'>üí° –í—É–ª–∏—Ü—å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ —Ü—å–æ–º—É –º—ñ—Å—Ç—ñ</span>";
                            noMatch.style.pointerEvents = "none";
                            autocompleteDiv.appendChild(noMatch);
                        }
                    } catch (error) {
                        console.error('Street autocomplete error:', error);
                        autocompleteDiv.innerHTML = '';
                        const errorDiv = document.createElement("DIV");
                        errorDiv.innerHTML = "<span style='color: #6c757d;'>‚úèÔ∏è –ü—Ä–æ—Å—Ç–æ –≤–≤–æ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –≤—É–ª–∏—Ü—ñ</span>";
                        errorDiv.style.pointerEvents = "none";
                        autocompleteDiv.appendChild(errorDiv);
                    }
                }, 700); // 700ms delay for streets

            });

            streetInput.addEventListener("keydown", function(e) {
                let x = document.getElementById(this.id + "-autocomplete-list");
                if (x) x = x.getElementsByTagName("div");
                if (e.keyCode == 40) { // DOWN
                    currentFocus++;
                    addActiveStreet(x);
                } else if (e.keyCode == 38) { // UP
                    currentFocus--;
                    addActiveStreet(x);
                } else if (e.keyCode == 13) { // ENTER
                    e.preventDefault();
                    if (currentFocus > -1) {
                        if (x) x[currentFocus].click();
                    }
                }
            });

            function addActiveStreet(x) {
                if (!x) return false;
                removeActiveStreet(x);
                if (currentFocus >= x.length) currentFocus = 0;
                if (currentFocus < 0) currentFocus = (x.length - 1);
                x[currentFocus].classList.add("autocomplete-active");
            }

            function removeActiveStreet(x) {
                for (let i = 0; i < x.length; i++) {
                    x[i].classList.remove("autocomplete-active");
                }
            }

            function closeAllListsStreet(elmnt) {
                const items = document.getElementsByClassName("autocomplete-items");
                for (let i = 0; i < items.length; i++) {
                    if (elmnt != items[i] && elmnt != streetInput) {
                        items[i].parentNode.removeChild(items[i]);
                    }
                }
            }

            document.addEventListener("click", function (e) {
                closeAllListsStreet(e.target);
            });
        }

        function swapLocations() {
            // Swap cities
            const fromCity = document.getElementById('fromCity');
            const toCity = document.getElementById('toCity');
            const tempCity = fromCity.value;
            fromCity.value = toCity.value;
            toCity.value = tempCity;
            
            // Swap streets
            const fromStreet = document.getElementById('fromStreet');
            const toStreet = document.getElementById('toStreet');
            const tempStreet = fromStreet.value;
            fromStreet.value = toStreet.value;
            toStreet.value = tempStreet;
            
            // Swap house numbers
            const fromHouse = document.getElementById('fromHouse');
            const toHouse = document.getElementById('toHouse');
            const tempHouse = fromHouse.value;
            fromHouse.value = toHouse.value;
            toHouse.value = tempHouse;
            
            // Add animation effect
            [fromCity, toCity, fromStreet, toStreet, fromHouse, toHouse].forEach(field => {
                field.style.transition = 'transform 0.2s';
                field.style.transform = 'scale(1.05)';
                setTimeout(() => {
                    field.style.transform = 'scale(1)';
                }, 200);
            });
            
            // Hide previous route info
            document.getElementById('routeInfo').style.display = 'none';
            document.getElementById('errorMsg').style.display = 'none';
        }

        function selectRoute(from, to, distance) {
            document.getElementById('fromCity').value = from;
            document.getElementById('toCity').value = to;
            document.getElementById('distance').value = distance;
            
            // Clear street and house fields
            document.getElementById('fromStreet').value = '';
            document.getElementById('fromHouse').value = '';
            document.getElementById('toStreet').value = '';
            document.getElementById('toHouse').value = '';
            
            // Close routes table
            document.getElementById('routesDetails').open = false;
            
            // Show confirmation
            const routeInfo = document.getElementById('routeInfo');
            const routeData = document.getElementById('routeData');
            
            routeInfo.style.display = 'block';
            routeData.innerHTML = `
                <div class="route-info-item">
                    <span class="route-info-label">‚úÖ –ú–∞—Ä—à—Ä—É—Ç:</span>
                    <span class="route-info-value">${from} ‚Üí ${to}</span>
                </div>
                <div class="route-info-item">
                    <span class="route-info-label">üìè –í—ñ–¥—Å—Ç–∞–Ω—å:</span>
                    <span class="route-info-value">${distance} –∫–º</span>
                </div>
            `;
            
            // Scroll to distance field smoothly
            document.getElementById('distance').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        async function calculateRoute() {
            // Build full addresses from separate fields
            const fromCity = document.getElementById('fromCity').value.trim();
            const fromStreet = document.getElementById('fromStreet').value.trim();
            const fromHouse = document.getElementById('fromHouse').value.trim();
            
            const toCity = document.getElementById('toCity').value.trim();
            const toStreet = document.getElementById('toStreet').value.trim();
            const toHouse = document.getElementById('toHouse').value.trim();

            if (!fromCity || !toCity) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –º—ñ—Å—Ç–∞ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è —Ç–∞ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è');
                return;
            }
            
            // Build full addresses
            let fromAddress = fromCity;
            if (fromStreet) fromAddress += ', ' + fromStreet;
            if (fromHouse) fromAddress += ', ' + fromHouse;
            
            let toAddress = toCity;
            if (toStreet) toAddress += ', ' + toStreet;
            if (toHouse) toAddress += ', ' + toHouse;

            const routeInfo = document.getElementById('routeInfo');
            const loading = document.getElementById('loading');
            const routeData = document.getElementById('routeData');
            const errorMsg = document.getElementById('errorMsg');

            routeInfo.style.display = 'block';
            loading.style.display = 'block';
            routeData.innerHTML = '';
            errorMsg.style.display = 'none';

            try {
                console.log('–ü–æ—á–∞—Ç–æ–∫ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –º–∞—Ä—à—Ä—É—Ç—É:', fromAddress, '‚Üí', toAddress);
                
                // Using OSRM (Open Source Routing Machine) API
                const fromCoords = await geocode(fromAddress);
                console.log('–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:', fromCoords);
                
                // Add delay between requests
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                const toCoords = await geocode(toAddress);
                console.log('–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:', toCoords);

                // Add delay before route calculation
                await new Promise(resolve => setTimeout(resolve, 1000));

                const routeUrl = `https://router.project-osrm.org/route/v1/driving/${fromCoords.lon},${fromCoords.lat};${toCoords.lon},${toCoords.lat}?overview=false`;
                console.log('URL –º–∞—Ä—à—Ä—É—Ç—É:', routeUrl);
                
                const response = await fetch(routeUrl);
                
                if (!response.ok) {
                    throw new Error(`HTTP –ø–æ–º–∏–ª–∫–∞: ${response.status}`);
                }

                const data = await response.json();
                console.log('–í—ñ–¥–ø–æ–≤—ñ–¥—å API:', data);

                if (data.code === 'Ok' && data.routes && data.routes.length > 0) {
                    const distance = Math.round(data.routes[0].distance / 1000);
                    const duration = Math.round(data.routes[0].duration / 3600);

                    document.getElementById('distance').value = distance;

                    routeData.innerHTML = `
                        <div class="route-info-item">
                            <span class="route-info-label">‚úÖ –í—ñ–¥—Å—Ç–∞–Ω—å:</span>
                            <span class="route-info-value">${distance.toLocaleString('uk-UA')} –∫–º</span>
                        </div>
                        <div class="route-info-item">
                            <span class="route-info-label">‚è±Ô∏è –û—Ä—ñ—î–Ω—Ç–æ–≤–Ω–∏–π —á–∞—Å:</span>
                            <span class="route-info-value">${duration} –≥–æ–¥</span>
                        </div>
                    `;
                    
                    loading.style.display = 'none';
                    console.log('–£—Å–ø—ñ—à–Ω–æ —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω–æ:', distance, '–∫–º');
                } else {
                    throw new Error('–ù–µ –≤–¥–∞–ª–æ—Å—è —Ä–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –º–∞—Ä—à—Ä—É—Ç: ' + (data.message || '–Ω–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞'));
                }
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É:', error);
                errorMsg.innerHTML = `‚ö†Ô∏è <strong>–ù–µ –≤–¥–∞–ª–æ—Å—è —Ä–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –º–∞—Ä—à—Ä—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ</strong><br><br>
                    <small><strong>–ü—Ä–∏—á–∏–Ω–∞:</strong> ${error.message}<br><br>
                    üìã <strong>–©–æ —Ä–æ–±–∏—Ç–∏:</strong><br>
                    1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ—Å—Ç—å –∞–¥—Ä–µ—Å–∏/–º—ñ—Å—Ç–∞<br>
                    2. –í–∏–±–µ—Ä—ñ—Ç—å –º–∞—Ä—à—Ä—É—Ç –∑ —Ç–∞–±–ª–∏—Ü—ñ "–ü–æ–ø—É–ª—è—Ä–Ω—ñ –º–∞—Ä—à—Ä—É—Ç–∏" –≤–∏—â–µ<br>
                    3. –ê–±–æ –≤–≤–µ–¥—ñ—Ç—å –≤—ñ–¥—Å—Ç–∞–Ω—å –≤—Ä—É—á–Ω—É –≤ –ø–æ–ª—ñ –Ω–∏–∂—á–µ</small>`;
                errorMsg.style.display = 'block';
                routeInfo.style.display = 'none';
                loading.style.display = 'none';
            }
        }

        async function geocode(city) {
            // Remove extra spaces and normalize
            const location = city.trim();
            
            console.log('–ü–æ—à—É–∫ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –¥–ª—è:', location);
            
            // Try multiple search strategies (limited to Ukraine, Moldova, Romania, Bulgaria, Turkey)
            const searches = [
                location,                          // As is
                location.split(',')[0].trim()     // Just city name without address
            ];

            for (let searchQuery of searches) {
                try {
                    console.log('–°–ø—Ä–æ–±–∞ –ø–æ—à—É–∫—É:', searchQuery);
                    
                    const response = await fetch(
                        `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(searchQuery)}&countrycodes=ua,md,ro,bg,tr&limit=15&addressdetails=1`,
                        {
                            headers: {
                                'Accept-Language': 'uk,ru,en,ro,bg,tr'
                            }
                        }
                    );
                    
                    if (!response.ok) {
                        console.error('HTTP –ø–æ–º–∏–ª–∫–∞:', response.status);
                        continue;
                    }
                    
                    const data = await response.json();
                    console.log('–ó–Ω–∞–π–¥–µ–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤:', data.length, data);
                    
                    if (data.length > 0) {
                        // Prefer more specific results for addresses
                        // Prefer cities/towns for simple city names
                        let bestResult;
                        
                        // If input looks like an address (has comma or numbers)
                        if (location.includes(',') || /\d/.test(location)) {
                            // Prefer results with street/house number
                            bestResult = data.find(r => 
                                r.address && (r.address.road || r.address.house_number)
                            ) || data.find(r => 
                                r.type === 'city' || r.type === 'town'
                            ) || data[0];
                        } else {
                            // Prefer city/town results
                            bestResult = data.find(r => 
                                r.type === 'city' || 
                                r.type === 'town' || 
                                r.class === 'place'
                            ) || data[0];
                        }

                        console.log('–í–∏–±—Ä–∞–Ω–æ:', bestResult.display_name, '–¢–∏–ø:', bestResult.type);
                        
                        return {
                            lat: parseFloat(bestResult.lat),
                            lon: parseFloat(bestResult.lon),
                            name: bestResult.display_name
                        };
                    }
                } catch (e) {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –≥–µ–æ–∫–æ–¥–∏–Ω–≥—É –¥–ª—è –∑–∞–ø–∏—Ç—É:', searchQuery, e);
                }
            }
            
            throw new Error(`–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–Ω–∞–π—Ç–∏ –º—ñ—Å—Ü–µ "${location}". –°–ø—Ä–æ–±—É–π—Ç–µ –≤–≤–µ—Å—Ç–∏ –ø–æ–≤–Ω—ñ—à—É –Ω–∞–∑–≤—É –∞–±–æ –≤–∏–±–µ—Ä—ñ—Ç—å –∑ —Ç–∞–±–ª–∏—Ü—ñ.`);
        }

        function calculate() {
            // Force sync fuel consumption from automatic calculation if available
            const autoConsumption = document.getElementById('calculatedConsumption');
            if (autoConsumption && autoConsumption.textContent && document.getElementById('fuelCalculation').style.display === 'block') {
                const consumptionValue = parseFloat(autoConsumption.textContent);
                if (!isNaN(consumptionValue) && consumptionValue > 0) {
                    document.getElementById('fuelConsumption').value = consumptionValue.toFixed(1);
                }
            }
            
            const distance = parseFloat(document.getElementById('distance').value);
            
            if (distance === 0 || isNaN(distance)) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –≤—ñ–¥—Å—Ç–∞–Ω—å –º–∞—Ä—à—Ä—É—Ç—É');
                return;
            }

            // Get values
            const tripCost = parseFloat(document.getElementById('tripCost').value) || 0;
            const days = parseFloat(document.getElementById('days').value);
            const fuelConsumption = parseFloat(document.getElementById('fuelConsumption').value);
            const fuelPrice = parseFloat(document.getElementById('fuelPrice').value);
            const salary = parseFloat(document.getElementById('salary').value);
            const perDiem = parseFloat(document.getElementById('perDiem').value);
            const amortization = parseFloat(document.getElementById('amortization').value);
            const maintenance = parseFloat(document.getElementById('maintenance').value);
            const other = parseFloat(document.getElementById('other').value);

            // Calculate fuel
            const totalFuel = (distance * fuelConsumption) / 100;
            const fuelCost = totalFuel * fuelPrice;

            // Calculate labor costs (removed tax 22% for management reporting)
            const perDiemTotal = days * perDiem;

            // Calculate total cost (without tax)
            const totalCost = fuelCost + salary + perDiemTotal + amortization + maintenance + other;
            const costPerKm = totalCost / distance;

            // Calculate profit
            const profit = tripCost - totalCost;
            const profitMargin = tripCost > 0 ? (profit / tripCost * 100) : 0;

            // Display results
            document.getElementById('totalFuel').textContent = `${totalFuel.toFixed(2)} –ª`;
            document.getElementById('fuelCost').textContent = `${fuelCost.toLocaleString('uk-UA', {minimumFractionDigits: 2, maximumFractionDigits: 2})} –≥—Ä–Ω`;
            document.getElementById('salaryResult').textContent = `${salary.toLocaleString('uk-UA', {minimumFractionDigits: 2, maximumFractionDigits: 2})} –≥—Ä–Ω`;
            document.getElementById('perDiemResult').textContent = `${perDiemTotal.toLocaleString('uk-UA', {minimumFractionDigits: 2, maximumFractionDigits: 2})} –≥—Ä–Ω`;
            document.getElementById('amortizationResult').textContent = `${amortization.toLocaleString('uk-UA', {minimumFractionDigits: 2, maximumFractionDigits: 2})} –≥—Ä–Ω`;
            document.getElementById('maintenanceResult').textContent = `${maintenance.toLocaleString('uk-UA', {minimumFractionDigits: 2, maximumFractionDigits: 2})} –≥—Ä–Ω`;
            document.getElementById('otherResult').textContent = `${other.toLocaleString('uk-UA', {minimumFractionDigits: 2, maximumFractionDigits: 2})} –≥—Ä–Ω`;
            document.getElementById('totalCost').textContent = `${totalCost.toLocaleString('uk-UA', {minimumFractionDigits: 2, maximumFractionDigits: 2})} –≥—Ä–Ω`;
            document.getElementById('costPerKm').textContent = `${costPerKm.toLocaleString('uk-UA', {minimumFractionDigits: 2, maximumFractionDigits: 2})} –≥—Ä–Ω/–∫–º`;

            // Display profit if trip cost is entered
            const profitBox = document.getElementById('profitBox');
            if (tripCost > 0) {
                profitBox.style.display = 'block';
                document.getElementById('tripCostDisplay').textContent = `${tripCost.toLocaleString('uk-UA', {minimumFractionDigits: 2, maximumFractionDigits: 2})} –≥—Ä–Ω`;
                document.getElementById('profit').textContent = `${profit.toLocaleString('uk-UA', {minimumFractionDigits: 2, maximumFractionDigits: 2})} –≥—Ä–Ω`;
                document.getElementById('profitMargin').textContent = `${profitMargin.toFixed(1)}%`;
                
                // Change color based on profit
                if (profit < 0) {
                    profitBox.style.background = 'linear-gradient(135deg, #FF3B30 0%, #CC2E26 100%)';
                } else if (profit < totalCost * 0.1) {
                    profitBox.style.background = 'linear-gradient(135deg, #FFC000 0%, #CC9900 100%)';
                } else {
                    profitBox.style.background = 'linear-gradient(135deg, #00C853 0%, #00A043 100%)';
                }
            } else {
                profitBox.style.display = 'none';
            }

            document.getElementById('results').style.display = 'block';
            document.getElementById('results').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Auto-calculate on any input change
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('input', function() {
                const resultsDiv = document.getElementById('results');
                if (resultsDiv.style.display === 'block') {
                    calculate();
                }
            });
        });

        // Auto-calculate driver salary (15% of trip cost)
        document.getElementById('tripCost').addEventListener('input', function() {
            const tripCost = parseFloat(this.value) || 0;
            const salary = tripCost * 0.15;
            document.getElementById('salary').value = Math.round(salary);
            
            // Recalculate if results are visible
            const resultsDiv = document.getElementById('results');
            if (resultsDiv.style.display === 'block') {
                calculate();
            }
        });

        // Auto-calculate fuel consumption from odometer and tank readings
        function calculateFuelData() {
            const odometerStart = parseFloat(document.getElementById('odometerStart').value) || 0;
            const odometerEnd = parseFloat(document.getElementById('odometerEnd').value) || 0;
            const fuelStart = parseFloat(document.getElementById('fuelStart').value) || 0;
            const fuelEnd = parseFloat(document.getElementById('fuelEnd').value) || 0;
            const fuelRefill = parseFloat(document.getElementById('fuelRefill').value) || 0;

            // Calculate distance from odometer
            const calculatedDistance = odometerEnd - odometerStart;
            
            // Calculate fuel used: (start + refill - end)
            const fuelUsed = fuelStart + fuelRefill - fuelEnd;
            
            // Calculate consumption per 100km
            const consumption = calculatedDistance > 0 ? (fuelUsed / calculatedDistance * 100) : 0;

            // Display results if we have valid data
            if (calculatedDistance > 0) {
                document.getElementById('calculatedDistance').textContent = calculatedDistance.toFixed(0) + ' –∫–º';
                document.getElementById('calculatedFuelUsed').textContent = fuelUsed.toFixed(1) + ' –ª';
                document.getElementById('calculatedConsumption').textContent = consumption.toFixed(2) + ' –ª/100–∫–º';
                document.getElementById('fuelCalculation').style.display = 'block';
                
                // Auto-fill distance field
                document.getElementById('distance').value = calculatedDistance;
                
                // Auto-fill fuel consumption if reasonable (between 15-40 l/100km)
                if (consumption >= 15 && consumption <= 40) {
                    const fuelField = document.getElementById('fuelConsumption');
                    fuelField.value = consumption.toFixed(1);
                    
                    // Highlight the field briefly to show it was updated
                    fuelField.style.background = '#fff3e0';
                    fuelField.style.transition = 'background 0.5s';
                    setTimeout(() => {
                        fuelField.style.background = 'white';
                    }, 1500);
                }
            } else {
                document.getElementById('fuelCalculation').style.display = 'none';
            }
        }

        // Add listeners to odometer and fuel fields
        ['odometerStart', 'odometerEnd', 'fuelStart', 'fuelEnd', 'fuelRefill'].forEach(id => {
            document.getElementById(id).addEventListener('input', calculateFuelData);
        });

        // Calculate trip duration from dates
        function calculateTripDuration() {
            const startDate = document.getElementById('tripStartDate').value;
            const endDate = document.getElementById('tripEndDate').value;

            if (startDate && endDate) {
                const start = new Date(startDate);
                const end = new Date(endDate);
                
                // Calculate difference in milliseconds
                const diffMs = end - start;
                
                if (diffMs > 0) {
                    // Convert to days (rounded up)
                    const diffDays = Math.ceil(diffMs / (1000 * 60 * 60 * 24));
                    
                    // Calculate hours and minutes for display
                    const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
                    const diffMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
                    
                    // Update display
                    let durationText = '';
                    if (diffDays >= 1) {
                        durationText = `${diffDays} –¥–Ω. (${diffHours} –≥–æ–¥ ${diffMinutes} —Ö–≤)`;
                    } else {
                        durationText = `${diffHours} –≥–æ–¥ ${diffMinutes} —Ö–≤`;
                    }
                    
                    document.getElementById('calculatedDuration').textContent = durationText;
                    document.getElementById('tripDuration').style.display = 'block';
                    
                    // Auto-fill days field
                    document.getElementById('days').value = diffDays;
                } else {
                    document.getElementById('tripDuration').style.display = 'none';
                }
            } else {
                document.getElementById('tripDuration').style.display = 'none';
            }
        }

        // Add listeners to date fields
        document.getElementById('tripStartDate').addEventListener('change', calculateTripDuration);
        document.getElementById('tripEndDate').addEventListener('change', calculateTripDuration);

        // Route management functions
        let customRoutes = [];
        
        const defaultRoutes = [
            ["–ö–∏—ó–≤", "–í—ñ–Ω–Ω–∏—Ü—è", 267], ["–ö–∏—ó–≤", "–î–Ω—ñ–ø—Ä–æ", 480], ["–ö–∏—ó–≤", "–ñ–∏—Ç–æ–º–∏—Ä", 140],
            ["–ö–∏—ó–≤", "–ó–∞–ø–æ—Ä—ñ–∂–∂—è", 520], ["–ö–∏—ó–≤", "–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫", 590], ["–ö–∏—ó–≤", "–ö—Ä–æ–ø–∏–≤–Ω–∏—Ü—å–∫–∏–π", 310],
            ["–ö–∏—ó–≤", "–õ—É—Ü—å–∫", 410], ["–ö–∏—ó–≤", "–õ—å–≤—ñ–≤", 540], ["–ö–∏—ó–≤", "–ú–∏–∫–æ–ª–∞—ó–≤", 490],
            ["–ö–∏—ó–≤", "–û–¥–µ—Å–∞", 475], ["–ö–∏—ó–≤", "–ü–æ–ª—Ç–∞–≤–∞", 340], ["–ö–∏—ó–≤", "–†—ñ–≤–Ω–µ", 315],
            ["–ö–∏—ó–≤", "–°—É–º–∏", 350], ["–ö–∏—ó–≤", "–¢–µ—Ä–Ω–æ–ø—ñ–ª—å", 440], ["–ö–∏—ó–≤", "–•–∞—Ä–∫—ñ–≤", 480],
            ["–ö–∏—ó–≤", "–•–µ—Ä—Å–æ–Ω", 600], ["–ö–∏—ó–≤", "–•–º–µ–ª—å–Ω–∏—Ü—å–∫–∏–π", 380], ["–ö–∏—ó–≤", "–ß–µ—Ä–∫–∞—Å–∏", 195],
            ["–ö–∏—ó–≤", "–ß–µ—Ä–Ω—ñ–≤—Ü—ñ", 470], ["–ö–∏—ó–≤", "–ß–µ—Ä–Ω—ñ–≥—ñ–≤", 145],
            ["–õ—å–≤—ñ–≤", "–û–¥–µ—Å–∞", 790], ["–õ—å–≤—ñ–≤", "–•–∞—Ä–∫—ñ–≤", 1020], ["–õ—å–≤—ñ–≤", "–î–Ω—ñ–ø—Ä–æ", 820],
            ["–û–¥–µ—Å–∞", "–•–∞—Ä–∫—ñ–≤", 730], ["–û–¥–µ—Å–∞", "–î–Ω—ñ–ø—Ä–æ", 450],
            ["–•–∞—Ä–∫—ñ–≤", "–î–Ω—ñ–ø—Ä–æ", 215], ["–•–∞—Ä–∫—ñ–≤", "–ó–∞–ø–æ—Ä—ñ–∂–∂—è", 280], ["–î–Ω—ñ–ø—Ä–æ", "–ó–∞–ø–æ—Ä—ñ–∂–∂—è", 85]
        ];

        function addNewRoute() {
            const from = document.getElementById('newRouteFrom').value.trim();
            const to = document.getElementById('newRouteTo').value.trim();
            const distance = parseInt(document.getElementById('newRouteDistance').value);

            if (!from || !to || !distance || distance <= 0) {
                alert('–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ!');
                return;
            }

            // Add to custom routes
            customRoutes.push([from, to, distance]);
            
            // Update table
            updateRoutesTable();
            
            // Clear inputs
            document.getElementById('newRouteFrom').value = '';
            document.getElementById('newRouteTo').value = '';
            document.getElementById('newRouteDistance').value = '';
            
            alert(`‚úÖ –ú–∞—Ä—à—Ä—É—Ç "${from} ‚Üí ${to}" (${distance} –∫–º) –¥–æ–¥–∞–Ω–æ!\n\nüíæ –ù–µ –∑–∞–±—É–¥—å—Ç–µ –Ω–∞—Ç–∏—Å–Ω—É—Ç–∏ "–ó–±–µ—Ä–µ–≥—Ç–∏ –º–∞—Ä—à—Ä—É—Ç–∏" —â–æ–± –∑–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏.`);
        }

        function updateRoutesTable() {
            const allRoutes = [...defaultRoutes, ...customRoutes];
            const tbody = document.getElementById('routesTable');
            
            tbody.innerHTML = '';
            
            allRoutes.forEach((route, idx) => {
                const [from, to, distance] = route;
                const row = document.createElement('tr');
                row.style.borderBottom = '1px solid var(--border)';
                row.style.background = idx % 2 === 0 ? '#f8f9fa' : 'white';
                row.style.cursor = 'pointer';
                row.onclick = () => selectRoute(from, to, distance);
                
                row.innerHTML = `
                    <td style="padding: 10px;"><strong>${from}</strong> ‚Üí ${to}</td>
                    <td style="padding: 10px; text-align: right; font-weight: 600;">${distance}</td>
                    <td style="padding: 10px; text-align: center; color: var(--success);">‚úì</td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Update count
            document.getElementById('routeCount').textContent = `${allRoutes.length} –º–∞—Ä—à—Ä—É—Ç—ñ–≤`;
        }

        function saveRoutesToStorage() {
            try {
                localStorage.setItem('customRoutes', JSON.stringify(customRoutes));
                alert('‚úÖ –ú–∞—Ä—à—Ä—É—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–æ!\n\n–í–æ–Ω–∏ –±—É–¥—É—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ñ –ø—Ä–∏ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞.');
            } catch (e) {
                alert('‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è: ' + e.message);
            }
        }

        function loadRoutesFromStorage() {
            try {
                const saved = localStorage.getItem('customRoutes');
                if (saved) {
                    customRoutes = JSON.parse(saved);
                    updateRoutesTable();
                    alert(`‚úÖ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ ${customRoutes.length} –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –º–∞—Ä—à—Ä—É—Ç—ñ–≤!`);
                } else {
                    alert('‚ÑπÔ∏è –ù–µ–º–∞—î –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –º–∞—Ä—à—Ä—É—Ç—ñ–≤.');
                }
            } catch (e) {
                alert('‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è: ' + e.message);
            }
        }

        function resetToDefaultRoutes() {
            if (confirm('‚ö†Ô∏è –°–∫–∏–Ω—É—Ç–∏ –≤—Å—ñ –∑–º—ñ–Ω–∏ —Ç–∞ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –º–∞—Ä—à—Ä—É—Ç–∏?\n\n–í–∞—à—ñ –¥–æ–¥–∞–Ω—ñ –º–∞—Ä—à—Ä—É—Ç–∏ –±—É–¥—É—Ç—å –≤–∏–¥–∞–ª–µ–Ω—ñ.')) {
                customRoutes = [];
                localStorage.removeItem('customRoutes');
                updateRoutesTable();
                alert('‚úÖ –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –º–∞—Ä—à—Ä—É—Ç–∏!');
            }
        }

        // Load custom routes on page load
        window.addEventListener('load', () => {
            const saved = localStorage.getItem('customRoutes');
            if (saved) {
                try {
                    customRoutes = JSON.parse(saved);
                    updateRoutesTable();
                } catch (e) {
                    console.error('Error loading custom routes:', e);
                }
            }
        });

        // Function to generate and print waybill
        function printWaybill() {
            // Get all data
            const driver = document.getElementById('driver');
            const driverName = driver.options[driver.selectedIndex].text;
            const truck = document.getElementById('truck').value;
            const trailer = document.getElementById('trailer').value;
            
            const fromCity = document.getElementById('fromCity').value;
            const fromStreet = document.getElementById('fromStreet').value;
            const fromHouse = document.getElementById('fromHouse').value;
            const toCity = document.getElementById('toCity').value;
            const toStreet = document.getElementById('toStreet').value;
            const toHouse = document.getElementById('toHouse').value;
            
            let fromAddress = fromCity;
            if (fromStreet) fromAddress += ', ' + fromStreet;
            if (fromHouse) fromAddress += ', ' + fromHouse;
            
            let toAddress = toCity;
            if (toStreet) toAddress += ', ' + toStreet;
            if (toHouse) toAddress += ', ' + toHouse;
            
            const distance = document.getElementById('distance').value;
            const tripStartDate = document.getElementById('tripStartDate').value;
            const tripEndDate = document.getElementById('tripEndDate').value;
            const cargoName = document.getElementById('cargoName').value.trim() || '‚Äî';
            const odometerStart = document.getElementById('odometerStart').value;
            const odometerEnd = document.getElementById('odometerEnd').value;
            const fuelStart = document.getElementById('fuelStart').value;
            const fuelEnd = document.getElementById('fuelEnd').value;
            const fuelRefill = document.getElementById('fuelRefill').value;
            const fuelConsumption = document.getElementById('fuelConsumption').value;
            const fuelPrice = document.getElementById('fuelPrice').value;
            
            // Calculate mileage difference
            const mileageDiff = odometerEnd && odometerStart ? (parseFloat(odometerEnd) - parseFloat(odometerStart)) : 0;
            
            // Calculate trip duration
            let tripDurationText = '‚Äî';
            let tripDurationDays = 0;
            if (tripStartDate && tripEndDate) {
                const start = new Date(tripStartDate);
                const end = new Date(tripEndDate);
                const diffMs = end - start;
                
                if (diffMs > 0) {
                    tripDurationDays = Math.ceil(diffMs / (1000 * 60 * 60 * 24));
                    const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
                    const diffMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
                    
                    if (tripDurationDays >= 1) {
                        tripDurationText = `${tripDurationDays} –¥–Ω. (${diffHours} –≥–æ–¥ ${diffMinutes} —Ö–≤)`;
                    } else {
                        tripDurationText = `${diffHours} –≥–æ–¥ ${diffMinutes} —Ö–≤`;
                    }
                }
            }
            
            // Format dates for display
            const formatDateTime = (dateTimeStr) => {
                if (!dateTimeStr) return '‚Äî';
                const date = new Date(dateTimeStr);
                return date.toLocaleString('uk-UA', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            };
            
            // Validate required fields
            if (!driverName || driverName === '-- –í–∏–±–µ—Ä—ñ—Ç—å –≤–æ–¥—ñ—è --') {
                alert('–í–∏–±–µ—Ä—ñ—Ç—å –≤–æ–¥—ñ—è');
                return;
            }
            if (!fromCity || !toCity) {
                alert('–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –ø—É–Ω–∫—Ç–∏ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è —Ç–∞ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è');
                return;
            }
            
            // Get current date
            const today = new Date();
            const dateStr = today.toLocaleDateString('uk-UA', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            // Generate filename: TruckNumber_StartOdometer-EndOdometer_DriverSurname.pdf
            // Example: BH5291PX_125000-125540_–°—Ç–∞—Ä–æ–¥—É–±.pdf
            const driverSurname = driverName.split(' ')[0]; // First word is surname
            const filename = `${truck || '–ê–≤—Ç–æ'}_${odometerStart || '0'}-${odometerEnd || '0'}_${driverSurname}.pdf`;
            
            // Store filename for print dialog
            window.waybillFilename = filename;
            
            // Create waybill HTML - compact one-page version
            const waybillHTML = `
                <div id="waybillPrint" style="padding: 30px; font-family: 'Manrope', Arial, sans-serif; max-width: 800px; margin: 0 auto; font-size: 13px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h1 style="margin: 0; font-size: 20px; text-transform: uppercase;">–ü–£–¢–ò–í–ù–ò–ô –õ–ò–°–¢</h1>
                        <p style="margin: 3px 0; color: #666; font-size: 12px;">–≤–∞–Ω—Ç–∞–∂–Ω–æ–≥–æ –∞–≤—Ç–æ–º–æ–±—ñ–ª—è</p>
                        <p style="margin: 3px 0; color: #666; font-size: 12px;">${dateStr}</p>
                    </div>
                    
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 15px;">
                        <tr>
                            <td style="padding: 6px; border: 1px solid #000; font-weight: 600; width: 35%; background: #f5f5f5; font-size: 12px;">–í–æ–¥—ñ–π:</td>
                            <td style="padding: 6px; border: 1px solid #000; font-size: 12px;">${driverName}</td>
                        </tr>
                        <tr>
                            <td style="padding: 6px; border: 1px solid #000; font-weight: 600; background: #f5f5f5; font-size: 12px;">–ê–≤—Ç–æ–º–æ–±—ñ–ª—å (—Ç—è–≥–∞—á):</td>
                            <td style="padding: 6px; border: 1px solid #000; font-size: 12px;">${truck || '‚Äî'}</td>
                        </tr>
                        <tr>
                            <td style="padding: 6px; border: 1px solid #000; font-weight: 600; background: #f5f5f5; font-size: 12px;">–ü—Ä–∏—á—ñ–ø:</td>
                            <td style="padding: 6px; border: 1px solid #000; font-size: 12px;">${trailer || '‚Äî'}</td>
                        </tr>
                    </table>
                    
                    <h3 style="margin: 15px 0 8px 0; border-bottom: 2px solid #0057B7; padding-bottom: 3px; font-size: 14px;">–ú–ê–†–®–†–£–¢ –Ü –ß–ê–°</h3>
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 15px;">
                        <tr>
                            <td style="padding: 6px; border: 1px solid #000; font-weight: 600; width: 35%; background: #f5f5f5; font-size: 12px;">–ü—É–Ω–∫—Ç –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:</td>
                            <td style="padding: 6px; border: 1px solid #000; font-size: 12px;">${fromAddress}</td>
                        </tr>
                        <tr>
                            <td style="padding: 6px; border: 1px solid #000; font-weight: 600; background: #f5f5f5; font-size: 12px;">–ü—É–Ω–∫—Ç –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:</td>
                            <td style="padding: 6px; border: 1px solid #000; font-size: 12px;">${toAddress}</td>
                        </tr>
                        <tr>
                            <td style="padding: 6px; border: 1px solid #000; font-weight: 600; background: #fff3e0; font-size: 12px;">–ù–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è –≤–∞–Ω—Ç–∞–∂—É:</td>
                            <td style="padding: 6px; border: 1px solid #000; background: #fff3e0; font-weight: 600; font-size: 12px;">${cargoName}</td>
                        </tr>
                        <tr>
                            <td style="padding: 6px; border: 1px solid #000; font-weight: 600; background: #f5f5f5; font-size: 12px;">–í—ñ–¥—Å—Ç–∞–Ω—å:</td>
                            <td style="padding: 6px; border: 1px solid #000; font-size: 12px;">${distance} –∫–º</td>
                        </tr>
                        <tr>
                            <td style="padding: 6px; border: 1px solid #000; font-weight: 600; background: #fff3e0; font-size: 12px;">–ü–æ—á–∞—Ç–æ–∫ —Ä–µ–π—Å—É:</td>
                            <td style="padding: 6px; border: 1px solid #000; background: #fff3e0; font-weight: 600; font-size: 12px;">${formatDateTime(tripStartDate)}</td>
                        </tr>
                        <tr>
                            <td style="padding: 6px; border: 1px solid #000; font-weight: 600; background: #fff3e0; font-size: 12px;">–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ä–µ–π—Å—É:</td>
                            <td style="padding: 6px; border: 1px solid #000; background: #fff3e0; font-weight: 600; font-size: 12px;">${formatDateTime(tripEndDate)}</td>
                        </tr>
                        <tr style="background: #e3f2fd;">
                            <td style="padding: 6px; border: 1px solid #000; font-weight: 600; font-size: 12px;">–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å —Ä–µ–π—Å—É:</td>
                            <td style="padding: 6px; border: 1px solid #000; font-weight: 700; color: #0057B7; font-size: 13px;">${tripDurationText}</td>
                        </tr>
                    </table>
                    
                    <h3 style="margin: 15px 0 8px 0; border-bottom: 2px solid #0057B7; padding-bottom: 3px; font-size: 14px;">–ü–û–ö–ê–ó–ê–ù–ù–Ø –ü–†–ò–õ–ê–î–Ü–í</h3>
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 15px;">
                        <tr style="background: #f5f5f5;">
                            <th style="padding: 6px; border: 1px solid #000; text-align: left; width: 35%; font-size: 12px;"></th>
                            <th style="padding: 6px; border: 1px solid #000; text-align: center; width: 32.5%; font-size: 12px;">–ù–∞ –ø–æ—á–∞—Ç–æ–∫</th>
                            <th style="padding: 6px; border: 1px solid #000; text-align: center; width: 32.5%; font-size: 12px;">–í –∫—ñ–Ω—Ü—ñ</th>
                        </tr>
                        <tr>
                            <td style="padding: 6px; border: 1px solid #000; font-weight: 600; font-size: 12px;">–û–¥–æ–º–µ—Ç—Ä (–∫–º):</td>
                            <td style="padding: 6px; border: 1px solid #000; text-align: center; font-size: 12px;">${odometerStart || '‚Äî'}</td>
                            <td style="padding: 6px; border: 1px solid #000; text-align: center; font-size: 12px;">${odometerEnd || '‚Äî'}</td>
                        </tr>
                        ${mileageDiff > 0 ? `
                        <tr style="background: #e3f2fd;">
                            <td style="padding: 6px; border: 1px solid #000; font-weight: 600; font-size: 12px;">–ü—Ä–æ–±—ñ–≥ –∑–∞ —Ä–µ–π—Å (—Ä—ñ–∑–Ω–∏—Ü—è):</td>
                            <td colspan="2" style="padding: 6px; border: 1px solid #000; text-align: center; font-weight: 700; color: #0057B7; font-size: 13px;">${mileageDiff} –∫–º</td>
                        </tr>
                        ` : ''}
                        <tr>
                            <td style="padding: 6px; border: 1px solid #000; font-weight: 600; font-size: 12px;">–ü–∞–ª–∏–≤–æ –≤ –±–∞–∫—É (–ª):</td>
                            <td style="padding: 6px; border: 1px solid #000; text-align: center; font-size: 12px;">${fuelStart || '‚Äî'}</td>
                            <td style="padding: 6px; border: 1px solid #000; text-align: center; font-size: 12px;">${fuelEnd || '‚Äî'}</td>
                        </tr>
                        <tr>
                            <td style="padding: 6px; border: 1px solid #000; font-weight: 600; background: #fff3e0; font-size: 12px;">–ó–∞–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –¥–æ—Ä–æ–∑—ñ (–ª):</td>
                            <td colspan="2" style="padding: 6px; border: 1px solid #000; text-align: center; background: #fff3e0; font-weight: 700; font-size: 12px;">${fuelRefill || '‚Äî'}</td>
                        </tr>
                    </table>
                    
                    <h3 style="margin: 15px 0 8px 0; border-bottom: 2px solid #0057B7; padding-bottom: 3px; font-size: 14px;">–í–ò–¢–†–ê–¢–ê –ü–ê–õ–ò–í–ê</h3>
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                        <tr>
                            <td style="padding: 6px; border: 1px solid #000; font-weight: 600; width: 35%; background: #f5f5f5; font-size: 12px;">–§–∞–∫—Ç–∏—á–Ω–∞ –≤–∏—Ç—Ä–∞—Ç–∞:</td>
                            <td style="padding: 6px; border: 1px solid #000; font-size: 12px;">${fuelConsumption} –ª/100–∫–º</td>
                        </tr>
                    </table>
                    
                    <div style="margin-top: 30px;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr>
                                <td style="padding: 10px 0; width: 50%;">
                                    <div style="font-size: 12px;">–í–æ–¥—ñ–π: ___________________________</div>
                                    <div style="margin-top: 3px; color: #666; font-size: 10px;">(–ø—ñ–¥–ø–∏—Å)</div>
                                </td>
                                <td style="padding: 10px 0; width: 50%; text-align: right;">
                                    <div style="font-size: 12px;">–î–∏—Å–ø–µ—Ç—á–µ—Ä: ___________________________</div>
                                    <div style="margin-top: 3px; color: #666; font-size: 10px;">(–ø—ñ–¥–ø–∏—Å)</div>
                                </td>
                            </tr>
                        </table>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: center; color: #999; font-size: 10px; page-break-after: always;">
                        <p>–ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ: ${new Date().toLocaleString('uk-UA')}</p>
                    </div>
                    
                    <div class="no-print" style="text-align: center; margin-top: 30px;">
                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 2px solid #ffc107;">
                            <div style="font-weight: 600; color: #856404; margin-bottom: 8px;">üíæ –Ø–∫ –∑–±–µ—Ä–µ–≥—Ç–∏ –≤ PDF:</div>
                            <div style="font-size: 0.9rem; color: #856404; text-align: left; max-width: 500px; margin: 0 auto;">
                                <div style="margin: 5px 0;">1. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É "üñ®Ô∏è –î—Ä—É–∫—É–≤–∞—Ç–∏" –Ω–∏–∂—á–µ</div>
                                <div style="margin: 5px 0;">2. –í –¥—ñ–∞–ª–æ–∑—ñ –¥—Ä—É–∫—É –≤–∏–±–µ—Ä—ñ—Ç—å <strong>"–ó–±–µ—Ä–µ–≥—Ç–∏ —è–∫ PDF"</strong></div>
                                <div style="margin: 5px 0;">3. –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∞ –Ω–∞–∑–≤–∞ —Ñ–∞–π–ª—É:</div>
                                <div style="background: white; padding: 8px; border-radius: 4px; margin-top: 8px; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; word-break: break-all;">
                                    <strong>${filename}</strong>
                                </div>
                            </div>
                        </div>
                        
                        <button onclick="window.print()" style="padding: 15px 40px; background: #0057B7; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer;">
                            üñ®Ô∏è –î—Ä—É–∫—É–≤–∞—Ç–∏ / –ó–±–µ—Ä–µ–≥—Ç–∏ PDF
                        </button>
                        <button onclick="document.getElementById('waybillPrint').remove()" style="padding: 15px 40px; background: #6c757d; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; margin-left: 10px;">
                            ‚úï –ó–∞–∫—Ä–∏—Ç–∏
                        </button>
                    </div>
                </div>
            `;
            
            // Remove old waybill if exists
            const oldWaybill = document.getElementById('waybillPrint');
            if (oldWaybill) {
                oldWaybill.remove();
            }
            
            // Insert waybill into page
            document.body.insertAdjacentHTML('beforeend', waybillHTML);
            
            // Set document title to suggested filename (will be used as default PDF name)
            const originalTitle = document.title;
            document.title = filename.replace('.pdf', '');
            
            // Scroll to waybill
            document.getElementById('waybillPrint').scrollIntoView({ behavior: 'smooth' });
            
            // Restore original title after print dialog closes
            window.addEventListener('afterprint', function restoreTitle() {
                document.title = originalTitle;
                window.removeEventListener('afterprint', restoreTitle);
            });
        }

        // Function to save waybill as HTML file
        function saveWaybillAsHTML() {
            // First generate the waybill
            printWaybill();
            
            // Wait a moment for waybill to be created
            setTimeout(() => {
                const waybillDiv = document.getElementById('waybillPrint');
                if (!waybillDiv) {
                    alert('‚ö†Ô∏è –°–ø–æ—á–∞—Ç–∫—É –∑–≥–µ–Ω–µ—Ä—É–π—Ç–µ –ø—É—Ç–∏–≤–Ω–∏–π –ª–∏—Å—Ç!');
                    return;
                }
                
                // Get the waybill HTML
                const waybillHTML = waybillDiv.innerHTML;
                
                // Create complete HTML document
                const fullHTML = `<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—É—Ç–∏–≤–Ω–∏–π –ª–∏—Å—Ç - ${window.waybillFilename || '–ó–≤—ñ—Ç'}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        @media print {
            body { padding: 0; }
        }
    </style>
</head>
<body>
${waybillHTML}
</body>
</html>`;
                
                // Create blob and download
                const blob = new Blob([fullHTML], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = (window.waybillFilename || '–ü—É—Ç–∏–≤–Ω–∏–π_–ª–∏—Å—Ç') + '.html';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert('‚úÖ –ó–≤—ñ—Ç –∑–±–µ—Ä–µ–∂–µ–Ω–æ!\n\n–§–∞–π–ª: ' + a.download + '\n\n–í–∏ –º–æ–∂–µ—Ç–µ –≤—ñ–¥–∫—Ä–∏—Ç–∏ –π–æ–≥–æ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ –∞–±–æ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏.');
                
                // Close the preview
                waybillDiv.remove();
            }, 500);
        }

        // ============ PWA FUNCTIONALITY ============
        
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js?v=2.4')
                    .then((registration) => {
                        console.log('‚úÖ PWA: Service Worker –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ', registration.scope);
                    })
                    .catch((error) => {
                        console.log('‚ùå PWA: –ü–æ–º–∏–ª–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó Service Worker', error);
                    });
            });
        }

        // Install prompt
        let deferredPrompt;
        const installButton = document.createElement('button');
        installButton.innerHTML = 'üì± –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –¥–æ–¥–∞—Ç–æ–∫';
        installButton.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #00C853 0%, #00A043 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: 700;
            font-size: 0.9rem;
            box-shadow: 0 4px 15px rgba(0, 200, 83, 0.4);
            cursor: pointer;
            z-index: 1000;
            display: none;
            font-family: 'Manrope', sans-serif;
        `;

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installButton.style.display = 'block';
            document.body.appendChild(installButton);
        });

        installButton.addEventListener('click', async () => {
            if (!deferredPrompt) {
                return;
            }
            
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
                console.log('‚úÖ PWA –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
            }
            
            deferredPrompt = null;
            installButton.style.display = 'none';
        });

        // Hide install button after installation
        window.addEventListener('appinstalled', () => {
            console.log('‚úÖ PWA —É—Å–ø—ñ—à–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!');
            installButton.style.display = 'none';
            deferredPrompt = null;
        });

        // Show notification if running as installed app
        if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true) {
            console.log('‚úÖ –î–æ–¥–∞—Ç–æ–∫ –∑–∞–ø—É—â–µ–Ω–æ —è–∫ PWA');
        }
    </script>
</body>
</html>